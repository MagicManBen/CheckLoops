<!DOCTYPE html>
<html>
<head>
    <title>PDF.js Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>
<body>
    <h1>PDF.js Test</h1>
    <div id="status"></div>
    <input type="file" id="fileInput" accept=".pdf">
    <div id="result"></div>

    <script>
        const statusDiv = document.getElementById('status');
        
        function updateStatus(message) {
            console.log(message);
            statusDiv.innerHTML += message + '<br>';
        }
        
        function initializePdfJs() {
            if (typeof pdfjsLib !== 'undefined') {
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                updateStatus('‚úÖ PDF.js loaded and worker configured');
                setupFileInput();
            } else {
                updateStatus('‚ùå PDF.js not yet available, retrying...');
                setTimeout(initializePdfJs, 100);
            }
        }
        
        function setupFileInput() {
            const fileInput = document.getElementById('fileInput');
            const resultDiv = document.getElementById('result');
            
            fileInput.addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (!file || file.type !== 'application/pdf') {
                    updateStatus('‚ùå Please select a PDF file');
                    return;
                }
                
                try {
                    updateStatus('üìÑ Processing PDF: ' + file.name);
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                    
                    updateStatus(`‚úÖ PDF loaded successfully: ${pdf.numPages} pages`);
                    
                    // Convert first page to image
                    const page = await pdf.getPage(1);
                    const viewport = page.getViewport({ scale: 2.0 });
                    
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.width = viewport.width;
                    canvas.height = viewport.height;
                    
                    await page.render({ canvasContext: context, viewport: viewport }).promise;
                    
                    updateStatus('‚úÖ PDF converted to image successfully');
                    
                    // Show the image
                    resultDiv.innerHTML = '<h3>Converted Image:</h3>';
                    resultDiv.appendChild(canvas);
                    
                } catch (error) {
                    updateStatus('‚ùå Error: ' + error.message);
                    console.error(error);
                }
            });
        }
        
        // Start initialization
        updateStatus('üîÑ Starting PDF.js initialization...');
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializePdfJs);
        } else {
            initializePdfJs();
        }
    </script>
</body>
</html>