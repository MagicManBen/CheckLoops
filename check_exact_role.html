<!DOCTYPE html>
<html>
<head>
    <title>Check Exact Role</title>
    <script src="config.js"></script>
</head>
<body>
    <h1>Checking Exact User Role</h1>
    <div id="output"></div>

    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

        const output = document.getElementById('output');
        function log(message) {
            console.log(message);
            output.innerHTML += message + '<br>';
        }

        const supabase = createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);

        // Sign in first
        const { data: authData, error: authError } = await supabase.auth.signInWithPassword({
            email: 'benhowardmagic@hotmail.com',
            password: 'Hello1!'
        });

        if (authError) {
            log(`Auth error: ${authError.message}`);
        } else {
            log(`<strong>Signed in successfully</strong>`);
            log(`User ID: ${authData.user.id}`);
            log(`Email: ${authData.user.email}`);

            // Check profile
            const { data: profile, error: profileError } = await supabase
                .from('profiles')
                .select('*')
                .eq('user_id', authData.user.id)
                .single();

            if (profileError) {
                log(`Profile error: ${profileError.message}`);
            } else {
                log('<br><strong>Profile data:</strong>');
                log(`- Role: <strong style="color: red">${profile.role}</strong>`);
                log(`- Full name: ${profile.full_name}`);
                log(`- Site ID: ${profile.site_id}`);
                log(`- Created: ${profile.created_at}`);

                // Check what roles would allow admin access
                const role = profile.role?.toLowerCase();
                log('<br><strong>Admin access check:</strong>');
                log(`- Is "admin"? ${role === 'admin' ? 'YES ✅' : 'NO ❌'}`);
                log(`- Is "owner"? ${role === 'owner' ? 'YES ✅' : 'NO ❌'}`);
                log(`- Is "site_hd"? ${role === 'site_hd' ? 'YES ✅' : 'NO ❌'}`);
                log(`- Is "staff"? ${role === 'staff' ? 'YES ✅' : 'NO ❌'}`);

                if (role !== 'admin' && role !== 'owner' && role !== 'site_hd') {
                    log('<br><strong style="color: red">⚠️ This user does NOT have admin access!</strong>');
                    log('To fix: Either change role to "admin" or add "staff" to allowed roles');
                }
            }

            // Sign out
            await supabase.auth.signOut();
        }
    </script>
</body>
</html>