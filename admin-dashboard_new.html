<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<title>CheckLoop — Admin</title>
<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.supabase.co https://*.supabase.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com data:; img-src 'self' data: blob: https:; connect-src 'self' https://*.supabase.co https://*.supabase.com wss://*.supabase.co wss://*.supabase.com https:;">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="pdf.min.js"></script>
<script src="xlsx.full.min.js"></script>
<script src="jszip.min.js"></script>
<script src="config.js"></script>
<script src="rls-fix.js"></script>
<script src="supabase-js.js"></script>
<link href="entitlement-card-styles.css" rel="stylesheet">
<script src="entitlement-card-layout.js" defer></script>
<script src="invitation-handler.js"></script>
<script type="module">
  const { createClient } = supabase;
  // Use EXACT same configuration as admin-login.html to share sessions
  const sb = createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY, {
    auth: {
      persistSession: true,
      autoRefreshToken: true,
      detectSessionInUrl: true,
      flowType: 'pkce',
      storage: window.localStorage,
      storageKey: `sb-${CONFIG.SUPABASE_URL.split('//')[1].split('.')[0]}-auth-token`
    }
  });
  window.supabase = sb;
  // Add small delay to prevent race condition with session loading
  setTimeout(async () => {
    try {
      const { data: { session } } = await sb.auth.getSession();
      if (!session) {
        console.log('Admin Dashboard: No session found, redirecting to login');
        sessionStorage.setItem('redirectAfterLogin', window.location.pathname);
        window.location.replace('admin-login.html');
        return;
      }
      console.log('Admin Dashboard: Session found for user:', session.user.email);
      const { data: profile } = await sb
        .from('master_users')
        .select('access_type')
        .eq('auth_user_id', session.user.id)
        .maybeSingle();
      const accessType = String(profile?.access_type || '').toLowerCase();
      const isAdmin = accessType === 'admin' || accessType === 'owner';
      console.log('Admin Dashboard: Access type:', accessType, '=> isAdmin:', isAdmin);
      if (!isAdmin) {
        console.log('Admin Dashboard: Not admin, redirecting to staff portal');
        window.location.replace('staff.html');
      } else {
        console.log('Admin Dashboard: Admin access confirmed, staying on dashboard');
        // Call bootstrap to initialize the dashboard with user data
        if (typeof bootstrap === 'function') {
          console.log('Admin Dashboard: Calling bootstrap()');
          bootstrap();
        } else {
          console.log('Admin Dashboard: bootstrap() not available yet, waiting...');
          // If bootstrap isn't defined yet, wait for the module to load
          window.addEventListener('DOMContentLoaded', () => {
            if (typeof bootstrap === 'function') {
              console.log('Admin Dashboard: Calling bootstrap() after DOM ready');
              bootstrap();
            }
          });
        }
      }
    } catch (e) {
      console.log('Admin Dashboard: Error checking session, redirecting to login:', e);
      window.location.replace('admin-login.html');
    }
  }, 1000); // Wait 1 second for session to fully load
  window.CONFIG = CONFIG;
  window.addEventListener('storage', (e) => {
    if (e.key && e.key.includes('sb-') && e.newValue === null) {
      try { window.location.replace('home.html'); } catch(_) {}
    }
  });
  window.addEventListener('load', async () => {
    try { await sb.auth.getSession(); } catch(_) {}
  });
  Object.defineProperty(window, 'getSupabase', { value: () => sb });
</script>
<script>
  // Configure PDF.js worker
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
  
  // Define debugLog to prevent errors - simple no-op function
  window.debugLog = function() {};
</script>

<script>
// Move existing help icons into a neat top-right badge per page header
document.addEventListener('DOMContentLoaded', () => {
  // Find all help-icon buttons that call showHelp('view-...')
  const icons = Array.from(document.querySelectorAll('button.help-icon'));
  icons.forEach(btn => {
    // Extract view id from onclick attribute if present
    const onclick = btn.getAttribute('onclick') || '';
    const m = onclick.match(/showHelp\(['"]([^'"]+)['"]\)/);
    if (!m) return;
    const viewId = m[1];

    // Find nearest .page-header ancestor
    const header = btn.closest('.page-header');
    if (!header) return;

    // Avoid adding multiple badges
    if (header.querySelector('.page-help-badge')) {
      btn.remove();
      return;
    }

    // Create badge (letter i) to sit immediately to the right of the page title
    const badge = document.createElement('button');
    badge.className = 'page-help-badge';
    badge.setAttribute('aria-label', 'Page help');
    badge.title = 'Page help';
    // Use a compact eye glyph for clarity
    badge.innerHTML = 'i';
    badge.addEventListener('click', (e) => {
      e.preventDefault();
      showHelp(viewId);
    });

    // Choose a contrasting theme for the badge based on header background
    // Default to light theme (dark text) which works on white headers
    let themeClass = 'light';
    const panelBg = getComputedStyle(header).backgroundColor || '';
    if (panelBg.startsWith('rgb(')) {
      const nums = panelBg.replace(/[rgba\(\) ]/g, '').split(',').map(n=>parseFloat(n));
      const avg = (nums[0] + nums[1] + nums[2]) / 3;
      themeClass = avg > 200 ? 'light' : 'dark';
    }
    badge.classList.add(themeClass);

    // Insert badge into the page title wrapper so it sits right of the title
    const titleWrapper = header.querySelector('.page-title-wrapper');
    if (titleWrapper) {
      titleWrapper.appendChild(badge);
    } else {
      header.appendChild(badge);
    }

    // Remove original button
    btn.remove();
  });

  // Remove unwanted buttons from the left sidebar menu
  try {
    const labelsToRemove = ['working hours', 'dashboard'];
    const navButtons = document.querySelectorAll('#sidebar .nav button');
    navButtons.forEach((btn) => {
      const labelEl = btn.querySelector('.menu-item-label');
      const text = (labelEl?.textContent || btn.textContent || '').trim().toLowerCase();
      if (labelsToRemove.includes(text)) {
        btn.remove();
      }
    });
  } catch (e) {
    console.warn('Could not remove some sidebar buttons:', e);
  }
});
</script>
<script>
</script>
<style>
  :root{
    --bg1:#0b4fb3; --bg2:#062b6f; --glass:#ffffff12; --glass-2:#ffffff1a;
    --white:#e6f0ff; --muted:#b8c7e8; --ink:#eaf1ff;
    --accent:#76a7ff; --accent-2:#5f96ff; --success:#2bd4a7; --danger:#ff6b6b;
    --warning: #ffca28;
    --shadow: 0 10px 30px rgba(6,43,111,.35);
    --round:18px;
    --panel-bg: linear-gradient(145deg, #133b8a, #0c275e);
    --border-color: #ffffff1f;
    --stat-1-bg: #8e6eff33; --stat-1-color: #c4b5fd;
    --stat-2-bg: #2bd4a733; --stat-2-color: #6ee7b7;
    --stat-3-bg: #ffca2833; --stat-3-color: #ffe082;
    --stat-4-bg: #ff6b6b33; --stat-4-color: #fca5a5;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    color:var(--ink); background:#0b3a86; overflow-x:hidden;
  }
  /* Silky animated background */
  .bg{
    position:fixed; inset:0; z-index:-1; overflow:hidden; background: radial-gradient(1200px 700px at 20% -10%, #6aa0ff33, transparent),
      radial-gradient(900px 600px at 90% 10%, #3566ff2e, transparent),
      linear-gradient(180deg, #0e3f93 0%, #082a69 100%);
  }
  .wave{
    position:absolute; width:160%; height:160%; left:-30%; top:-30%;
    background: conic-gradient(from 180deg at 50% 50%, #2c63ff22, #143a9622, #2c63ff22);
    filter: blur(60px);
    animation: drift 22s ease-in-out infinite alternate;
    transform-origin: 50% 50%;
  }
  .wave2{ animation-duration: 28s; mix-blend-mode: screen; }
  @keyframes drift{
    0%{ transform: rotate(0deg) scale(1.0); }
    100%{ transform: rotate(25deg) scale(1.08); }
  }

  /* Extra animated mesh and orbs for depth */
  .mesh{ position: fixed; inset: -20% -20% -20% -20%; z-index:-1; pointer-events:none; filter: blur(40px) saturate(120%); opacity:.55; }
  .m1, .m2, .m3 { position:absolute; border-radius:50%; }
  .m1{ width:55vw; height:55vw; left:-10%; top:-10%; background:radial-gradient(closest-side, #4f89ff55, transparent 70%); animation: blobA 26s ease-in-out infinite alternate; }
  .m2{ width:45vw; height:45vw; right:-8%; top:10%; background:radial-gradient(closest-side, #2bd4a755, transparent 70%); animation: blobB 32s ease-in-out infinite alternate; }
  .m3{ width:60vw; height:60vw; left:20%; bottom:-15%; background:radial-gradient(closest-side, #ffca2850, transparent 70%); animation: blobC 38s ease-in-out infinite alternate; }
  @keyframes blobA{ from{ transform: translate(0,0) rotate(0deg); } to{ transform: translate(6%,4%) rotate(30deg); } }
  @keyframes blobB{ from{ transform: translate(0,0) rotate(0deg); } to{ transform: translate(-4%,6%) rotate(-25deg); } }
  @keyframes blobC{ from{ transform: translate(0,0) rotate(0deg); } to{ transform: translate(4%,-3%) rotate(18deg); } }

  /* Floating particles animation */
  .particles { position: fixed; inset: 0; z-index: -1; pointer-events: none; overflow: hidden; }
  .particle { position: absolute; width: 4px; height: 4px; background: rgba(118, 167, 255, 0.6); border-radius: 50%; animation: floatUp 15s linear infinite; }
  .particle:nth-child(odd) { background: rgba(43, 212, 167, 0.6); animation-duration: 18s; }
  .particle:nth-child(3n) { background: rgba(255, 202, 40, 0.6); animation-duration: 20s; }
  @keyframes floatUp { 
    0% { transform: translateY(100vh) scale(0); opacity: 0; } 
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { transform: translateY(-100vh) scale(1.5); opacity: 0; } 
  }

  /* Glowing orbs */
  .orb { position: fixed; border-radius: 50%; filter: blur(40px); opacity: 0.3; animation: orbFloat 20s ease-in-out infinite; pointer-events: none; z-index: -1; }
  .orb1 { width: 300px; height: 300px; background: radial-gradient(circle, #7db1ff, transparent); top: 10%; left: 10%; animation-delay: 0s; }
  .orb2 { width: 200px; height: 200px; background: radial-gradient(circle, #2bd4a7, transparent); bottom: 20%; right: 10%; animation-delay: 5s; }
  .orb3 { width: 250px; height: 250px; background: radial-gradient(circle, #ffca28, transparent); top: 50%; left: 50%; animation-delay: 10s; }
  @keyframes orbFloat { 0%, 100% { transform: translate(0, 0); } 33% { transform: translate(30px, -30px); } 66% { transform: translate(-20px, 20px); } }

  /* Layout */
  .app{ display:grid; --sidebarW:260px; grid-template-columns: var(--sidebarW) minmax(0, 1fr); gap:22px; padding:22px; min-height:100vh; transition: grid-template-columns .2s ease; }
  .app.collapsed{ --sidebarW:56px; }
  /* Disable transitions during resize for smooth dragging */
  .app.is-resizing { transition: none !important; }
  .sidebar{
    background: linear-gradient(180deg, #1a4ea8 0%, #0e367e 100%);
    border-radius:20px; box-shadow: var(--shadow); padding:14px;
    transition: width 0.2s; position:relative; z-index:10;
  }
  .app.collapsed #sidebar {
    overflow-x: hidden;
    padding-left: 6px;
    padding-right: 6px;
  }
  /* When collapsed, ensure the toggle remains visible and centered at the top */
  .app.collapsed #sidebar > .sidebar-toggle { float: none; display: inline-grid; margin: 10px auto; }
  .app.collapsed #sidebar .brand .t,
  .app.collapsed #sidebar .brand .hint,
  .app.collapsed #sidebar .menu-item-label { display:none; }
  .app.collapsed #sidebar .nav button{ justify-content:center; gap:0; padding:10px; }
  .app.collapsed #sidebar .icon{ margin:0; }
  .sidebar-toggle {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--white);
    margin: 8px 6px;
    padding: 8px;
    display: inline-grid;
    place-items: center;
    border-radius: 10px;
    transition: transform .18s ease, background .12s ease, color .12s ease;
    background: transparent;
  }
  .sidebar-toggle:focus { outline: 2px solid var(--accent); box-shadow: 0 4px 12px rgba(0,0,0,.12); }
  .sidebar-toggle:hover { background: #ffffff12; }
  .sidebar-toggle-icon { color: var(--white); width:18px; height:18px; display:block; transition: transform .22s ease; }
  /* When the app is collapsed, rotate the chevron to point the other direction */
  .app.collapsed .sidebar-toggle-icon { transform: rotate(180deg); }

  /* Position the toggle visually near the top-right of the sidebar but keep it in the DOM flow */
  .sidebar > .sidebar-toggle { float: right; margin-top: 10px; margin-right: 6px; }
  .brand{ display:flex; align-items:center; gap:10px; padding:10px 12px 16px; }
  .brand .logo{ width:32px; height:32px; border-radius:10px; object-fit:contain; box-shadow: inset 0 0 0 2px #ffffff33; }
  .brand .t{ font-weight:800; letter-spacing:.2px }
  .menu-item-label{ font-weight:600; }

  .nav{ display:flex; flex-direction:column; gap:6px; margin-top:6px; }
  .nav button{
    all:unset; display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px;
    cursor:pointer; color:var(--white); opacity:.85; position:relative; z-index:5;
    transition: transform .12s ease, background .2s ease, opacity .2s ease;
    pointer-events:auto;
  }
  /* Group toggle for grouped menus (Configure / Checks & Audits) */
  .nav-group-toggle {
    all:unset; display:flex; align-items:center; justify-content:space-between; gap:8px;
    padding:8px 12px; color:var(--muted); font-weight:700; font-size:12px; cursor:pointer;
    border-radius:8px; margin-top:8px; position:relative; z-index:6; pointer-events:auto;
  }
  .nav-group-toggle:hover { background: #ffffff08; }
  .nav-group-toggle .caret {
    display:inline-block; width:10px; height:10px; transform-origin:center; transition: transform .18s ease, border-color .18s ease;
    border-right:2px solid var(--muted); border-bottom:2px solid var(--muted); transform: rotate(-45deg);
  }
  .nav-group-toggle[aria-expanded="true"] .caret { transform: rotate(45deg); border-color: var(--accent-2); }
  .nav-group { display:flex; flex-direction:column; gap:6px; padding-left:4px; }
  .nav-group.collapsed { display:none; }
  /* Tweak group toggles when sidebar collapsed: keep a compact, centred caret so the
     user still sees grouping affordance and icons remain visible (avoid disappearing UI). */
  .app.collapsed #sidebar .nav .nav-group-toggle {
    display:flex; align-items:center; justify-content:center; gap:0;
    padding:8px; border-radius:8px; margin-top:8px;
    color: var(--muted); background: transparent;
  }
  /* Ensure the caret remains visible and compact */
  .app.collapsed #sidebar .nav .nav-group-toggle .caret { display:block; transform: rotate(0deg); border-color: var(--muted); }

  /* Keep icons visible and consistent when collapsed */
  .app.collapsed #sidebar .nav .icon { margin:0; width:28px; height:28px; }

  /* Resize handle styling */
  #sidebar-resize-handle{
    position: absolute; top:0; right: -6px; width: 12px; height:100%; cursor: ew-resize; z-index:30;
    display:flex; align-items:center; justify-content:center; background: transparent;
  }
  #sidebar-resize-handle::before{
    content:''; width:2px; height:40px; background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.14)); border-radius:2px;
    box-shadow: 0 0 0 6px transparent; transition: box-shadow .12s ease;
  }
  #sidebar-resize-handle:active::before{ box-shadow: 0 0 8px 2px rgba(0,0,0,0.12); }

  /* User Profile Section */
  .user-profile {
    margin-top: auto;
    padding: 12px 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    border-top: 1px solid rgba(255,255,255,0.06);
  }

  .user-row {
    display: flex;
    align-items: center;
    gap: 12px;
    width: 100%;
  }

  .user-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--accent-2));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
    font-size: 18px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    transition: transform 0.18s ease;
    flex-shrink: 0;
  }

  .user-avatar:hover { transform: scale(1.04); }

  .user-details {
    text-align: left;
    min-width: 0;
    flex: 1;
  }

  .user-name {
    font-weight: 600;
    font-size: 14px;
    color: var(--white);
    margin-bottom: 2px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .site-info {
    font-size: 12px;
    color: var(--muted);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .btn-signout {
    all: unset;
    padding: 8px;
    border-radius: 8px;
    background: rgba(255,255,255,0.06);
    color: var(--white);
    cursor: pointer;
    transition: background 0.18s ease, transform 0.12s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
  }

  .btn-signout svg { width: 18px; height: 18px; }

  .btn-signout:hover { background: rgba(255,255,255,0.14); transform: translateY(-1px); }

  /* Staff View button spacing and fallback positioning */
  #staff-return { padding: 6px 8px; }
  #staff-return a { display:block; padding:8px 12px; width: calc(100% - 16px); box-sizing: border-box; margin: 0 6px; border-radius: 10px; text-align:left; }
  /* ensure the arrow and text have breathing room within sidebar */
  #staff-return a::before { content: '←'; margin-right:8px; opacity:0.95; }
  #staff-fallback { left:18px; top:18px; }
  #staff-fallback a { padding:8px 12px; border-radius:10px; box-shadow: 0 6px 18px rgba(2,6,23,0.06); }

  /* Make Sign Out visually match the Staff View button and be same height */
  #signout {
    display: block;
    padding: 8px 12px;
    /* Align visual width/offset with the Staff View button above */
    width: calc(100% - 8px);
    box-sizing: border-box;
    margin: 0 2px 8px 2px; /* 12px parent padding + 2px margin = 14px offset (same as #staff-return: 8px padding + 6px margin) */
    border-radius: 10px;
    text-align: left;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  #signout::before {
    content: '';
    display: inline-block;
    width: 14px; height: 14px;
    margin-right: 8px;
    vertical-align: -1px;
    background-repeat: no-repeat;
    background-size: 14px 14px;
    /* small logout SVG (stroke color inherits via filter not reliable in data URI) */
    background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4'/><polyline points='16 17 21 12 16 7'/><line x1='21' y1='12' x2='9' y2='12'/></svg>");
  }

  /* Collapsed sidebar adjustments */
  .app.collapsed .user-profile { padding: 12px 6px; }
  .app.collapsed .user-avatar { width: 36px; height: 36px; font-size: 14px; }
  .app.collapsed .user-details { display: none; }
  .app.collapsed .btn-signout { padding: 6px; }


  /* Hide nav-group-toggle label text when collapsed but keep the caret visible */
  .app.collapsed #sidebar .nav .nav-group-toggle { font-size: 0; }
  .app.collapsed #sidebar .nav .nav-group-toggle .caret { display:inline-block; width:10px; height:10px; transform-origin:center; border-right:2px solid var(--muted); border-bottom:2px solid var(--muted); }
  .app.collapsed #sidebar .nav .nav-group-toggle[aria-expanded="true"] .caret { transform: rotate(45deg); border-color: var(--accent-2); }
  
  /* When collapsed: show all icons for every page (flatten groups into the icon rail).
    Hide the group toggle labels so the rail is compact, but keep child buttons visible
    as centered icons for direct access. This restores the previous behaviour where
    minimized sidebar shows every page's icon. */
  .app.collapsed #sidebar .nav .nav-group-toggle { display: none !important; }
  .app.collapsed #sidebar .nav .nav-group { display: flex !important; flex-direction: column; gap:6px; padding-left: 0 !important; }
  .app.collapsed #sidebar .nav .nav-group.collapsed { display: flex !important; }
  .app.collapsed #sidebar .nav .nav-group button { all:unset; display:flex !important; align-items:center; justify-content:center; padding:10px; border-radius:8px; }
  /* Hide text/badges when collapsed — only icons should remain visible */
  .app.collapsed #sidebar .menu-item-label, .app.collapsed #sidebar .nav .nav-badge { display:none !important; }
  /* Ensure every nav button is visible in collapsed mode (covers edge cases where scripts add/remove classes) */
  .app.collapsed #sidebar .nav, .app.collapsed #sidebar .nav * { visibility: visible !important; }
  .app.collapsed #sidebar .nav button { display:flex !important; opacity:1 !important; }
  .app.collapsed #sidebar .nav .icon { display:block !important; }
  .nav button:hover{ transform: translateY(-1px); background: #ffffff14; opacity:1; }
  .nav button.active{ background:var(--accent); color:var(--white); opacity:1; font-weight:600; }
  .nav .icon{
    width:32px; height:32px; /* Larger, more legible icons */
    object-fit:contain; opacity:1;
    color: var(--white) !important; /* SVGs use currentColor */
    flex-shrink:0; display:inline-flex; align-items:center; justify-content:center;
  }
  .nav .icon svg{ width:100%; height:100%; stroke-width:3.2; }
  /* Bitmap-only filters (kept for legacy PNGs if any remain elsewhere) */
  .nav img.icon{ filter: brightness(0) invert(1); }
  .nav button.active img.icon{
    /* Approximate green for bitmap icons */
    filter: invert(64%) sepia(41%) saturate(498%) hue-rotate(98deg) brightness(92%) contrast(92%);
  }
  /* Ensure bitmap icons match SVG sizing */
  .nav img.icon{ width:32px; height:32px; object-fit:contain; }

  .nav-badge {
    margin-left: auto;
    font-size: 11px;
    background: var(--glass-2);
    padding: 2px 6px;
    border-radius: 99px;
    line-height: 1;
    opacity: 0.85;
  }
  .nav button.active .nav-badge {
    background: var(--accent);
    color: #fff;
  }
  .tab-controls .btn.secondary.active { background: var(--accent-2); border-color: var(--accent); color: var(--white); }


  .nav button:hover .icon{ opacity:1; }

  .content{ 
    padding:6px;
    height: calc(100vh - 44px); /* Account for app padding */
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  .search{
    flex:1; background:#ffffff17; border-radius:100px; padding:10px 14px; display:flex; align-items:center; gap:10px;
  }
  .search input{ all:unset; color:var(--ink); width:100%; font-size:14px; }
  .pill{ padding:8px 12px; border-radius:999px; background:#ffffff17; }
  .btn{ all:unset; padding:9px 14px; border-radius:12px; background:linear-gradient(135deg,#7db1ff,#4f89ff); color:#fff; font-weight:600; cursor:pointer; }
  .btn.secondary{ background:#ffffff1e; border:1px solid #ffffff26; }

  .panel{
    background: linear-gradient(145deg, rgba(19, 59, 138, 0.8), rgba(12, 39, 94, 0.9));
    border:1px solid var(--border-color); border-radius:22px; padding:24px; 
    box-shadow: var(--shadow), inset 0 1px 0 rgba(255,255,255,0.1);
    backdrop-filter: blur(12px);
    position: relative;
    overflow: hidden;
    animation: panelGlow 4s ease-in-out infinite;
  }
  @keyframes panelGlow { 
    0%, 100% { box-shadow: var(--shadow), inset 0 1px 0 rgba(255,255,255,0.1); } 
    50% { box-shadow: var(--shadow), inset 0 1px 0 rgba(255,255,255,0.1), 0 0 30px rgba(118, 167, 255, 0.3); } 
  }
  .panel::before{
    content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
    animation: shimmer 8s ease-in-out infinite;
  }
  @keyframes shimmer { 0%, 100% { left: -100%; } 50% { left: 100%; } }
  .panel-header { display:flex; align-items:center; gap:12px; margin-bottom:16px; }
  .panel-header svg { width:22px; height:22px; color:var(--accent); }
  .panel-title { font-weight:700; font-size:18px; }

  .grid{ display:grid; grid-template-columns: repeat(12, 1fr); gap:16px; }
  .g-12{ grid-column: span 12; }
  .g-6{ grid-column: span 6; }
  .g-4{ grid-column: span 4; }
  .g-3{ grid-column: span 3; }

  .h1{ font-size:32px; font-weight:900; letter-spacing:.2px; margin:6px 0 8px; }
  .muted{ color:var(--muted) }

  /* Modern clean global table styles */
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    background: #ffffff;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    font-size: 0.95rem;
    transition: all 0.3s ease;
  }

  table thead {
    background: linear-gradient(90deg, #4f46e5, #6366f1);
    color: #fff;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }
  table thead th {
    padding: 14px 16px;
    text-align: left;
  }

  table tbody tr {
    background: #fff;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  table tbody tr:nth-child(even) {
    background: #f9fafb;
  }
  table tbody tr:hover {
    transform: scale(1.01);
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    background: #f3f4f6;
  }
  table td {
    padding: 12px 16px;
    border-bottom: 1px solid #e5e7eb;
    color: #111827;
  }

  table tbody tr:last-child td {
    border-bottom: none;
  }

  table tbody {
    animation: fadeInUp 0.4s ease;
  }
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .table-wrap{ overflow:auto; max-height:420px; background: rgba(19, 59, 138, 0.4); border-radius: 12px; padding: 4px; backdrop-filter: blur(10px); box-shadow: inset 0 0 20px rgba(255,255,255,0.05); }
  .chip{ padding:4px 8px; background:#ffffff20; border-radius:999px; font-size:12px; display:inline-block }
  .chip.success { background: var(--stat-2-bg); color: var(--stat-2-color); }
  .chip.danger { background: var(--stat-4-bg); color: var(--stat-4-color); }
  .chip.warning { background: var(--stat-3-bg); color: var(--stat-3-color); }


  /* Sections (SPA) */
  section.view{ display:none; }
  section.view.active{ 
    display: flex; /* Changed from block to flex */
    animation: fadeIn .18s ease;
    flex: 1;
    overflow: hidden;
    flex-direction: column;
  }
  
  /* Make panels fill available space */
  section.view .panel {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    margin-bottom: 0; /* Remove bottom margin to use full space */
  }
  
  /* Specific table containers should be scrollable */
  .table-wrap {
    flex: 1;
    overflow-y: auto;
    margin-top: 16px;
  }
  
  /* Dashboard grid adjustments */
  section.view .grid {
    flex: 1;
    overflow-y: auto;
  }
  
  /* Grid panels should maintain their size but allow content scrolling */
  .grid .panel {
    flex: none; /* Don't flex in grid layout */
    min-height: 200px; /* Minimum size for grid panels */
  }
  
  /* Content within grid panels should be scrollable if needed */
  .grid .panel .table-wrap {
    max-height: 400px; /* Reasonable max height for grid tables */
  }
  @keyframes fadeIn{ from{opacity:0; transform:translateY(3px)} to{opacity:1; transform:none} }

  /* Auth overlay */
  .auth{
    position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:24px; background: #071c44d0; backdrop-filter: blur(6px); z-index: 10;
  }
  .auth.show{ display:flex; }
  .auth:not(.show) { pointer-events:none; }
  .card{ background:#0b2a64; border:1px solid #ffffff1f; border-radius:20px; box-shadow:var(--shadow); padding:22px; width:min(460px, 92vw); }
  .card h2{ margin:0 0 12px; }
  .field{ display:flex; flex-direction:column; gap:6px; margin:10px 0; }
  .field input, .field textarea { all:unset; background:#ffffff17; border:1px solid #ffffff24; padding:12px 12px; border-radius:12px; }
  .field textarea { min-height: 60px; }
  .hint{ font-size:12px; color:#b9c9ff; opacity:.9 }
  /* Dark-select styling for Windows/Edge */
  .ui-select{
    appearance:none; -webkit-appearance:none; -moz-appearance:none;
    background:#0b2a64; color:var(--ink);
    border:1px solid #ffffff24; border-radius:12px; padding:12px; width:100%;
  }
  .ui-select:focus{ outline:2px solid var(--accent); box-shadow:0 0 0 3px #76a7ff40; }
  .ui-select option{ background:#0b2a64; color:var(--ink); }
  .ui-select option:disabled{ color:#8aa0cf; }
  @media (forced-colors: active){
    .ui-select{ forced-color-adjust:none; background:Canvas; color:CanvasText; border-color:GrayText; }
    .ui-select option{ background:Canvas; color:CanvasText; }
  }
  .error{ color:var(--danger); font-size:12px; margin-top:6px; }

  .footer{ text-align:center; font-size:12px; color:#b7c8ff; opacity:.9; padding:22px 0; }

  /* Modal styles */
  .modal { 
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 30;
    background: rgba(7,28,68,0.85);
  }
  .modal.show { 
    display: flex; 
  }
  .modal:not(.show) { pointer-events:none; }
  .modal-content { 
    background: var(--panel-bg);
    border: 1px solid var(--border-color);
    border-radius: 18px;
    padding: 22px;
    box-shadow: var(--shadow);
    color: var(--white);
  }
  /* CRUD modal tweaks: keep buttons visible, make fields scrollable and more compact */
  #crud-modal .card {
    display: flex;
    flex-direction: column;
    max-height: 88vh; /* slightly taller but still limited */
    width: min(880px, 98vw); /* wider modal for more horizontal space */
    padding: 20px 22px;
  }
  #crud-modal form { display: flex; flex-direction: column; gap: 0; }
  #crud-fields {
  flex: 1 1 auto; /* let fields take remaining space */
  overflow-y: auto;
  padding-right: 8px; /* space for scrollbar */
  margin-bottom: 12px;
  /* Keep fields area within viewport so modal footer/buttons remain visible */
  max-height: calc(88vh - 140px); /* account for title and buttons */
  }
  /* Grid for form fields: single column on small screens, two balanced columns on wider */
  #crud-fields .crud-grid { 
    display: grid; 
    grid-template-columns: 1fr; 
    gap: 16px 24px; 
    align-items: start;
  }
  @media (min-width: 760px) {
    #crud-fields .crud-grid { grid-template-columns: 1fr 1fr; }
    /* allow some fields to span full width when needed */
    #crud-fields .field.full { grid-column: 1 / -1; }
  }
  
  /* Standardize all field containers and inputs for perfect alignment */
  #crud-modal .field { 
    box-sizing: border-box; 
    display: flex; 
    flex-direction: column; 
  }
  
  #crud-modal .field label { 
    margin-bottom: 6px; 
    font-weight: 600; 
    font-size: 14px; 
    line-height: 1.3;
    min-height: 18px; /* consistent label height */
  }
  
  /* Standardize ALL input elements to same height and styling */
  #crud-modal .field input[type="text"],
  #crud-modal .field input[type="date"], 
  #crud-modal .field .ui-select,
  #crud-modal .field select {
    height: 44px;
    padding: 0 12px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background: var(--input-bg);
    color: var(--text);
    font-size: 14px;
    box-sizing: border-box;
    line-height: 1.4;
  }
  
  /* Textareas get consistent styling but variable height */
  #crud-modal .field textarea { 
    padding: 12px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background: var(--input-bg);
    color: var(--text);
    font-size: 14px;
    box-sizing: border-box;
    resize: vertical;
    min-height: 88px;
    line-height: 1.4;
  }
  
  #crud-modal .field.full textarea { 
    min-height: 120px; 
  }
  
  /* Checkbox styling to align with other inputs */
  #crud-modal .field input[type="checkbox"] {
    width: 18px;
    height: 18px;
    margin-right: 8px;
  }
  
  /* Multi-select and datepicker wrapper alignment */
  #crud-modal .datepicker-wrapper {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  
  #crud-modal .datepicker-wrapper input {
    flex: 1;
  }
  
  #crud-modal .multi-select-wrapper {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  #crud-modal .staff-chips {
    min-height: 44px;
    padding: 8px 12px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background: var(--input-bg);
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    align-items: center;
  }
  
  /* File upload styling */
  .file-upload-area {
    transition: all 0.3s ease;
  }
  
  .file-upload-area:hover {
    opacity: 0.9;
  }
  
  .file-upload-area button {
    background: linear-gradient(135deg, var(--accent), var(--accent-2));
    color: var(--white);
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 12px rgba(118, 167, 255, 0.3);
  }
  
  .file-upload-area button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(118, 167, 255, 0.4);
  }
  
  .file-upload-area button span {
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  
  /* Modern form enhancements */
  .datepicker-wrapper { display: flex; gap: 8px; align-items: center; }
  .modern-datepicker { flex: 1; }
  
  /* Toggle completed button styling */
  #toggle-completed-btn:hover {
    background: rgba(255,255,255,0.2) !important;
    transform: scale(1.1);
  }
  #toggle-completed-btn:active {
    transform: scale(0.95);
  }
  
  /* Dashboard animations */
  @keyframes pulse {
    0% { transform: scale(1); opacity: 0.1; }
    50% { transform: scale(1.1); opacity: 0.2; }
    100% { transform: scale(1); opacity: 0.1; }
  }
  
  @keyframes scoreAnimation {
    0% { stroke-dashoffset: 565.48; }
    100% { stroke-dashoffset: 282.74; }
  }
  
  .metric-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.12);
  }
  
  .quick-action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }
  
  /* PIR Progress Toggle Button */
  #pir-progress-toggle:hover {
    background: rgba(59, 130, 246, 0.2) !important;
    border-color: rgba(59, 130, 246, 0.5) !important;
    transform: scale(1.05);
  }
  
  #pir-progress-toggle:active {
    transform: scale(0.95);
  }
  .quick-date { 
    height: 44px !important; 
    padding: 0 12px !important; 
    font-size: 14px; 
    white-space: nowrap; 
    border-radius: 8px !important;
    line-height: 1.4;
  }
  
  .age-select { font-weight: 500; }
  
  .multi-select-wrapper { display: flex; flex-direction: column; gap: 8px; }
  .staff-chips { display: flex; flex-wrap: wrap; gap: 6px; min-height: 24px; }
  .staff-chip { 
    background: var(--accent); 
    color: white; 
    padding: 6px 10px; 
    border-radius: 12px; 
    font-size: 12px; 
    display: flex; 
    align-items: center; 
    gap: 4px;
  }
  .staff-chip button { 
    background: none; 
    border: none; 
    color: white; 
    cursor: pointer; 
    padding: 0; 
    margin-left: 4px;
  }
  
  .category-select, .status-select, .priority-select, .avenue-select {
    font-weight: 500;
  }
  
  .category-select option[data-color]:not([value=""]) { font-weight: 600; }
  .status-select option[data-color]:not([value=""]) { font-weight: 600; }
  .priority-select option[data-color]:not([value=""]) { font-weight: 600; }
  
  /* Enhanced field labels with better spacing and icons */
  #crud-modal .field label { 
    font-weight: 600; 
    font-size: 13px; 
    margin-bottom: 4px;
    display: block;
  }

  /* Custom Time Input Styles */
  .time-input-container {
    display: flex;
    align-items: center;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background: var(--input-bg);
    overflow: hidden;
    width: 120px;
  }
  
  .time-input {
    display: flex;
    align-items: center;
    flex: 1;
    padding: 8px 12px;
    color: var(--text);
    font-size: 16px;
    font-weight: 600;
    text-align: center;
    min-width: 0;
  }
  
  .time-display {
    font-family: 'Courier New', monospace;
    font-size: 18px;
    font-weight: 700;
    color: var(--white);
    min-width: 60px;
    text-align: center;
  }
  
  .time-controls {
    display: flex;
    flex-direction: column;
    border-left: 1px solid var(--border-color);
  }
  
  .time-control-hours, .time-control-minutes {
    display: flex;
    flex-direction: column;
  }
  
  .time-arrow {
    background: rgba(255,255,255,0.1);
    border: none;
    color: var(--white);
    cursor: pointer;
    padding: 4px 8px;
    font-size: 12px;
    line-height: 1;
    transition: background 0.2s ease;
    user-select: none;
  }
  
  .time-arrow:hover {
    background: rgba(255,255,255,0.2);
  }
  
  .time-arrow:active {
    background: rgba(255,255,255,0.3);
  }
  
  .time-separator {
    width: 1px;
    background: var(--border-color);
    height: 100%;
  }
  
  .working-pattern-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 16px;
  }
  
  .day-input-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  
  .day-label {
    font-weight: 600;
    font-size: 14px;
    color: var(--white);
  }
  
  .schedule-clickable {
    cursor: pointer;
    color: var(--accent-2);
    text-decoration: underline;
    transition: color 0.2s ease;
  }
  
  .schedule-clickable:hover {
    color: var(--accent);
  }
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  .modal-header h3 {
    margin: 0;
    font-size: 20px;
    font-weight: 600;
  }
  .modal-close {
    all: unset;
    cursor: pointer;
    background: #ffffff12;
    border-radius: 999px;
    width: 34px;
    height: 34px;
    display: grid;
    place-items: center;
  }

  /* Training Matrix Styles */
  .training-matrix {
    overflow-x: auto;
    background: var(--panel-bg);
    border-radius: 16px;
    border: 1px solid var(--border-color);
  }
  .training-matrix table {
    min-width: 800px;
    border-collapse: separate;
    border-spacing: 0;
  }
  .training-matrix th {
    background: var(--panel-bg);
    position: sticky;
    top: 0;
    z-index: 2;
    writing-mode: vertical-lr;
    text-orientation: mixed;
    width: 120px;
    max-width: 120px;
    padding: 16px 8px;
    font-size: 12px;
    border-right: 1px solid var(--border-color);
    border-bottom: 1px solid var(--border-color);
  }
  .training-matrix th:first-child {
    writing-mode: horizontal-tb;
    text-orientation: initial;
    width: 200px;
    max-width: 200px;
    position: sticky;
    left: 0;
    z-index: 3;
  }
  .training-matrix td {
    padding: 8px;
    border-right: 1px solid var(--border-color);
    border-bottom: 1px solid var(--border-color);
    font-size: 11px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
    min-height: 40px;
    position: relative;
  }
  .training-matrix td:first-child {
    position: sticky;
    left: 0;
    background: var(--panel-bg);
    z-index: 1;
    cursor: default;
    font-weight: 600;
    text-align: left;
    padding-left: 16px;
  }
  .training-matrix td.training-cell:hover {
    background: var(--glass-2);
    transform: scale(1.02);
  }
  
  /* Training Status Colors */
  .training-completed { background: var(--stat-2-bg); color: var(--stat-2-color); }
  .training-expiring { background: var(--stat-3-bg); color: var(--stat-3-color); }
  .training-expired { background: var(--stat-4-bg); color: var(--stat-4-color); }
  .training-missing { background: var(--glass); color: var(--muted); opacity: 0.6; }

  /* Make complaints reporting button more obvious only when active */
  .nav button[data-section="complaints-reporting"].active {
    background: linear-gradient(135deg, #ff6b6b22, #ff6b6b33) !important;
    border: 1px solid #ff6b6b44 !important;
    box-shadow: 0 2px 8px rgba(255, 107, 107, 0.2) !important;
  }
  .nav button[data-section="complaints-reporting"].active:hover {
    background: linear-gradient(135deg, #ff6b6b33, #ff6b6b44) !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3) !important;
  }
  .nav button[data-section="complaints-reporting"].active .icon {
    color: #ff6b6b !important;
  }

  /* Small screens */
  @media (max-width: 980px){
    .app{ grid-template-columns: 1fr; }
    .sidebar{ position:sticky; top:0; z-index:2; }
    .g-4 { grid-column: span 12; }
  }
  @media (max-width: 600px){
    .stat-card { grid-column: span 12; }
  }

  /* Stat cards */
  .stat-card {
    display:flex; align-items:center; gap:16px;
    background: var(--glass); padding:16px; border-radius:16px;
    border: 1px solid var(--glass-2);
  }
  .stat-card .icon-wrap {
    width:48px; height:48px; border-radius:12px;
    display:grid; place-items:center; flex-shrink:0;
    background: var(--c); color: var(--i);
  }
  .stat-card .icon-wrap svg { width:24px; height:24px; }
  .stat-num { font-size:28px; font-weight:700; line-height:1.1; color:var(--white); }
  .stat-label { font-size:14px; color:var(--muted); }

  /* Weekly Calendar styles */
  .cal-day{ background:#ffffff0f; border:1px solid #ffffff1e; border-radius:14px; padding:12px; display:flex; flex-direction:column; gap:8px; }
  .cal-day-header { display: flex; justify-content: space-between; align-items: baseline; }
  .cal-day-label { font-weight: 600; color: var(--white); }
  .cal-day-summary { font-size: 12px; color: var(--muted); }
  .cal-day-bar-bg { width: 100%; height: 8px; background: var(--glass-2); border-radius: 99px; overflow: hidden; }
  .cal-day-bar-fg { height: 100%; background: var(--success); width: 0%; border-radius: 99px; transition: width .4s ease; }
  .cal-day-bar-fg.danger { background: var(--danger); }
  .cal-day-metrics { display: flex; justify-content: space-between; font-size: 11px; }
  .cal-metric.success { color: var(--success); }
  .cal-metric.danger { color: var(--danger); }
  
  /* Row hover/selected across all tables */
  tbody tr.selected{ background:#ffffff1e !important; }
  tbody[data-entity] tr{ cursor:pointer; }
  #subs-tbody tr { cursor: pointer; }


  /* Items view: full-height + sortable */
  /* Items view styles - now handled by general panel styles */
  #view-items .table-wrap{ flex:1; max-height:none; overflow:auto; }
  #view-items thead th.sortable{ cursor:pointer; user-select:none; }
  #view-items thead th .arrow{ font-size:11px; opacity:.9; margin-left:6px }

  /* Quiz view: allow table to fill the full height of the page */
  #view-quiz .table-wrap{ flex:1; max-height:none; overflow:auto; }

  /* Monthly Calendar Styles */
  #cal-grid { grid-auto-rows: 1fr; align-items: start; }
  .cal-cell {
    background: var(--glass);
    border: 1px solid var(--glass-2);
    border-radius: 12px;
    padding: 8px;
    display: flex;
    flex-direction: column;
    font-size: 12px;
    transition: background .12s ease;

    /* Keep cells perfectly square regardless of content/viewport */
    aspect-ratio: 1 / 1;
    min-height: 0; /* allow grid to calculate height from width */
    overflow: hidden;
  }
  .cal-cell.is-clickable { cursor: pointer; }
  .cal-cell.is-clickable:hover { background: var(--glass-2); }
  .cal-cell.other-month { opacity: .4; background: transparent; border-color:transparent; pointer-events:none; }
  .cal-cell.is-today .cal-day-num {
    background: var(--accent);
    color: var(--white);
    font-weight: 700;
  }
  .cal-day-num {
    font-weight: 600;
    font-size: 14px;
    width: 26px; height: 26px;
    display: grid; place-items: center;
    border-radius: 999px;
    margin-bottom: 4px;
    transition: all .2s ease;
    flex-shrink: 0;
  }
  .cal-tasks {
    flex-grow: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 4px;
    font-size: 11px;
    padding-right: 4px; /* for scrollbar */
  }
  /* Custom scrollbar for task list */
  .cal-tasks::-webkit-scrollbar { width: 4px; }
  .cal-tasks::-webkit-scrollbar-track { background: transparent; }
  .cal-tasks::-webkit-scrollbar-thumb { background: #ffffff33; border-radius: 4px; }

  .cal-task {
    display: flex;
    align-items: center;
    gap: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .cal-task-status {
    width: 18px; height: 18px;
    border-radius: 999px;
    flex-shrink: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    color: var(--white);
    background: var(--muted);
    opacity: .9;
    line-height: 1;
  }
  .cal-task-status.scheduled { background: var(--muted); color: var(--white); opacity: .85; }
  .cal-task-status.done { background: var(--success); color: var(--white); }
  .cal-task-status.missed { background: var(--danger); color: var(--white); }

  .freq-badge {
    font-size:10px;
    padding:2px 6px;
    border-radius:999px;
    background: rgba(255,255,255,0.06);
    color: var(--muted);
    margin-left: 8px;
    flex-shrink: 0;
  }
  .cal-legend { display:flex; gap:14px; align-items:center; color:var(--muted); font-size:12px; margin-bottom:12px; }
  .cal-legend .item { display:flex; gap:8px; align-items:center; }
  .cal-legend .dot { width:10px; height:10px; border-radius:999px; display:inline-block; }
  .cal-legend .dot.scheduled { background: var(--muted); opacity:.6 }
  .cal-legend .dot.done { background: var(--success) }
  .cal-legend .dot.missed { background: var(--danger) }

  /* Enhanced Calendar Visual Improvements */
  
  /* Improved calendar grid with better spacing and visual hierarchy */
  #view-calendar .panel {
    background: linear-gradient(135deg, var(--panel-bg) 0%, rgba(11, 75, 179, 0.02) 100%);
  }
  
  /* Enhanced calendar cells with subtle gradients and better contrast */
  .cal-cell {
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
    border: 1px solid rgba(255, 255, 255, 0.15);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease;
  }
  
  .cal-cell:hover {
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08));
    border-color: rgba(255, 255, 255, 0.25);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    transform: translateY(-1px);
  }
  
  .cal-cell.is-today {
    background: linear-gradient(145deg, rgba(118, 167, 255, 0.15), rgba(118, 167, 255, 0.08));
    border-color: var(--accent);
    box-shadow: 0 0 20px rgba(118, 167, 255, 0.3);
  }
  
  /* Enhanced day numbers with better visibility */
  .cal-day-num {
    background: rgba(255, 255, 255, 0.1);
    color: var(--white);
    border-radius: 8px;
    font-weight: 700;
    font-size: 15px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }
  
  .cal-cell.is-today .cal-day-num {
    background: var(--accent);
    color: #ffffff;
    box-shadow: 0 2px 8px rgba(118, 167, 255, 0.4);
  }
  
  .cal-cell.other-month .cal-day-num {
    background: transparent;
    color: rgba(255, 255, 255, 0.4);
  }
  
  /* Much improved task visibility and styling */
  .cal-task {
    background: rgba(255, 255, 255, 0.12);
    border-radius: 6px;
    padding: 4px 6px;
    margin: 1px 0;
    border-left: 3px solid var(--accent);
    color: var(--white);
    font-weight: 500;
    font-size: 11px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    transition: all 0.15s ease;
    backdrop-filter: blur(10px);
  }
  
  .cal-task:hover {
    background: rgba(255, 255, 255, 0.18);
    transform: translateX(2px);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
  }
  
  /* Enhanced task status indicators with better colors and visibility */
  .cal-task-status {
    background: rgba(255, 255, 255, 0.2);
    color: #ffffff;
    font-weight: 700;
    font-size: 9px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  }
  
  .cal-task-status.scheduled {
    background: linear-gradient(135deg, #64748b, #475569);
    border-color: #64748b;
    color: #ffffff;
  }
  
  .cal-task-status.done {
    background: linear-gradient(135deg, #10b981, #059669);
    border-color: #10b981;
    color: #ffffff;
    box-shadow: 0 0 6px rgba(16, 185, 129, 0.4);
  }
  
  .cal-task-status.missed {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-color: #ef4444;
    color: #ffffff;
    box-shadow: 0 0 6px rgba(239, 68, 68, 0.4);
    animation: pulse-red 2s infinite;
  }
  
  @keyframes pulse-red {
    0%, 100% { box-shadow: 0 0 6px rgba(239, 68, 68, 0.4); }
    50% { box-shadow: 0 0 12px rgba(239, 68, 68, 0.8); }
  }
  
  /* Enhanced legend with better styling */
  .cal-legend {
    background: rgba(255, 255, 255, 0.05);
    padding: 12px 16px;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    margin-bottom: 16px;
  }
  
  .cal-legend .item {
    font-weight: 500;
    color: var(--white);
  }
  
  .cal-legend .dot {
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }
  
  .cal-legend .dot.scheduled {
    background: linear-gradient(135deg, #64748b, #475569);
    opacity: 1;
  }
  
  .cal-legend .dot.done {
    background: linear-gradient(135deg, #10b981, #059669);
    box-shadow: 0 0 6px rgba(16, 185, 129, 0.3);
  }
  
  .cal-legend .dot.missed {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    box-shadow: 0 0 6px rgba(239, 68, 68, 0.3);
  }
  
  /* Calendar header improvements */
  #cal-header {
    background: rgba(255, 255, 255, 0.05);
    padding: 16px;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    margin-bottom: 20px;
  }
  
  #cal-month-year {
    color: var(--white);
    font-weight: 700;
    font-size: 20px;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  }
  
  /* Enhanced navigation buttons */
  #cal-prev, #cal-next {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: var(--white);
    font-weight: 600;
    transition: all 0.2s ease;
  }
  
  #cal-prev:hover, #cal-next:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: var(--accent);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  
  /* Weekday headers enhancement */
  #cal-weekdays {
    background: rgba(255, 255, 255, 0.08);
    padding: 12px 0;
    margin-bottom: 8px;
    border-radius: 10px;
    font-weight: 600;
    color: var(--white);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  }
  
  /* Day modal enhancements */
  .day-modal-card {
    background: linear-gradient(145deg, var(--panel-bg), rgba(11, 75, 179, 0.95));
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(20px);
  }
  
  /* Day modal */
  #day-modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 30; background: rgba(7,28,68,0.85); }
  #day-modal.show { display: flex; }
  .day-modal-card { width: min(900px, 86vw); background: var(--panel-bg); border:1px solid var(--border-color); border-radius:18px; padding:22px; box-shadow: var(--shadow); color: var(--white); }
  .day-modal-close { all:unset; float:right; cursor:pointer; background:#ffffff12; border-radius:999px; width:34px; height:34px; display:grid; place-items:center; }
  /* Branding modal */
  #branding-modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 31; background: rgba(7,28,68,0.85); }
  #branding-modal.show { display: flex; }
  .branding-card { width: min(700px, 92vw); background: var(--panel-bg); border:1px solid var(--border-color); border-radius:18px; padding:22px; box-shadow: var(--shadow); color: var(--white); }
  .branding-close { all:unset; float:right; cursor:pointer; background:#ffffff12; border-radius:999px; width:34px; height:34px; display:grid; place-items:center; }
  .branding-row { display:grid; grid-template-columns: 160px 1fr; gap:14px; align-items:center; margin:12px 0; }
  .branding-preview { width:160px; height:90px; border-radius:10px; background:#ffffff12; border:1px solid #ffffff22; display:grid; place-items:center; overflow:hidden; }
  .branding-preview img { max-width:100%; max-height:100%; object-fit:contain; }
  .branding-actions { display:flex; gap:10px; justify-content:flex-end; margin-top:14px; }
  .hint-mini { font-size: 12px; color: var(--muted); }
  
  #cal-view-switcher .btn.secondary.active {
    background: var(--accent-2);
    border-color: var(--accent);
    color: var(--white);
  }
  /* Pre-inspection View Styles */
  .progress-bar-bg { background: var(--glass-2); border-radius: 99px; height: 10px; overflow: hidden; }
  .progress-bar-fg { background: var(--success); height: 100%; width: 0%; border-radius: 99px; transition: width .4s ease; }
  
  /* Enhanced progress header with count display */
  .pir-progress-header {
  display: block;
    gap: 24px;
    align-items: center;
    margin-bottom: 24px;
    padding: 20px;
    background: var(--glass);
    border-radius: 16px;
    border: 1px solid var(--border-color);
  }
  
  .pir-progress-text {
    font-size: 28px;
    font-weight: 700;
    color: var(--white);
    text-align: center;
  }
  
  .pir-progress-label {
    font-size: 14px;
    color: var(--muted);
    margin-top: 4px;
    text-align: center;
  }

  /* Dedicated PIR progress panel that stretches full width */
  .pir-progress-panel { padding: 20px; border-radius: 16px; background: var(--panel-bg); border:1px solid var(--border-color); box-shadow: var(--shadow); margin-bottom: 24px; }
  .pir-progress-main { display:flex; flex-direction:column; gap:16px; }
  
  /* Enhanced full-width progress bar with clear outline and interactive effects */
  .progress-bar-container { 
    position: relative; 
    padding: 6px; 
    background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(0,0,0,0.05)); 
    border-radius: 999px; 
    border: 2px solid rgba(255,255,255,0.15);
    box-shadow: 
      0 4px 12px rgba(0,0,0,0.1),
      inset 0 1px 0 rgba(255,255,255,0.2),
      inset 0 -1px 0 rgba(0,0,0,0.1);
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .progress-bar-container:hover {
    transform: translateY(-1px);
    box-shadow: 
      0 6px 20px rgba(0,0,0,0.15),
      inset 0 1px 0 rgba(255,255,255,0.3),
      inset 0 -1px 0 rgba(0,0,0,0.15);
    border-color: rgba(255,255,255,0.25);
  }
  
  .progress-bar-bg { 
    background: var(--glass-2);
    border-radius: 999px; 
    height: 24px; 
    overflow: hidden; 
    position: relative;
  }
  
  /* Solid color progress foreground; color is controlled by JS based on % */
  .progress-bar-fg { 
    background: var(--success);
    height: 100%; 
    width: 0%; 
    border-radius: 999px; 
    transition: width 0.4s ease; 
  }
  
  /* Progress milestones */
  .progress-milestones {
    position: absolute;
    top: -8px;
    left: 6px;
    right: 6px;
    height: 40px;
    pointer-events: none;
  }
  
  .milestone {
    position: absolute;
    width: 2px;
    height: 16px;
    background: rgba(255,255,255,0.4);
    border-radius: 1px;
    top: 50%;
    transform: translateY(-50%);
  }
  
  .milestone.quarter { left: 25%; }
  .milestone.half { left: 50%; background: rgba(255,255,255,0.6); height: 20px; }
  .milestone.three-quarter { left: 75%; }
  
  /* Progress state animations and effects */
  .progress-bar-container.progress-low {
    animation: progressPulse 2s ease-in-out infinite;
  }
  
  .progress-bar-container.progress-medium {
    border-color: rgba(255,193,7,0.4);
  }
  
  .progress-bar-container.progress-high {
    border-color: rgba(40,167,69,0.4);
  }
  
  .progress-bar-container.progress-complete {
    border-color: rgba(16,185,129,0.6);
    animation: progressCelebrate 3s ease-in-out infinite;
  }
  
  @keyframes progressPulse {
    0%, 100% { 
      box-shadow: 0 4px 12px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.2);
    }
    50% { 
      box-shadow: 0 6px 20px rgba(220,53,69,0.3), inset 0 1px 0 rgba(255,255,255,0.3);
      border-color: rgba(220,53,69,0.4);
    }
  }
  
  @keyframes progressCelebrate {
    0%, 100% { 
      box-shadow: 0 4px 12px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.2);
    }
    50% { 
      box-shadow: 0 8px 25px rgba(16,185,129,0.4), inset 0 1px 0 rgba(255,255,255,0.4);
      transform: translateY(-2px);
    }
  }
  
  @keyframes progressClick {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
  }
  
  @keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  
  @keyframes slideOutRight {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
  }

  /* Standardized page headers with help icons */
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
  }
  
  .page-title-wrapper {
  display: flex;
  align-items: center; /* align title and badge vertically */
    gap: 8px;
    position: relative;
  }
  
  .page-title {
    font-size: 28px;
    font-weight: 700;
    color: var(--white);
    margin: 0;
    line-height: 1.2;
  }
  
  .help-icon {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    color: rgba(255,255,255,0.7);
    transition: all 0.2s ease;
    margin-top: 2px;
    flex-shrink: 0;
  }
  
  .help-icon:hover {
    background: rgba(255,255,255,0.15);
    border-color: rgba(255,255,255,0.4);
    color: var(--white);
    transform: scale(1.1);
  }

  /* Page help badge: inline eye/info button placed just to the right of the page title */
  .page-header { position: relative; }
  
  .page-help-badge {
    display: inline-grid;
    place-items: center;
    margin-left: 8px;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    font-weight: 800;
    font-size: 12px;
    cursor: pointer;
    transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s ease;
    position: relative;
    /* tiny pulse ring for interest */
  }
  
  /* Light theme (for light headers): darker text on light glass */
  .page-help-badge.light {
    background: linear-gradient(135deg, #ffffff, #f3f6fb);
    color: #0f1b3d;
    border: 1px solid rgba(0,0,0,0.08);
    box-shadow: 0 6px 18px rgba(16,24,40,0.08);
  }
  
  /* Dark theme (for dark headers): light text on dark glass */
  .page-help-badge.dark {
    background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.08));
    border: 1px solid rgba(255,255,255,0.2);
    color: rgba(255,255,255,0.95);
    box-shadow: 0 2px 8px rgba(2,6,23,0.15);
  }
  
  .page-help-badge::after {
    content: '';
    position: absolute;
    inset: -4px;
    border-radius: 999px;
    box-shadow: 0 0 0 0 rgba(118,167,255,0.35);
    opacity: 0.0;
    transition: box-shadow .2s ease, opacity .2s ease;
  }
  
  .page-help-badge:hover { 
    transform: translateY(-1px) scale(1.05); 
  }
  .page-help-badge:hover::after {
    opacity: 1;
    box-shadow: 0 0 0 6px rgba(118,167,255,0.18);
  }
  
  /* Help modal styles */
  .help-modal {
    position: fixed;
    inset: 0;
    background: rgba(7,28,68,0.85);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    backdrop-filter: blur(4px);
  }
  
  .help-modal.show {
    display: flex;
  }
  
  .help-modal-content {
  background: var(--panel-bg);
  border: 1px solid var(--border-color);
  border-radius: 16px;
  padding: 24px;
  max-width: 500px;
  width: 90%;
  box-shadow: 0 20px 40px rgba(0,0,0,0.3);
  /* Use readable text color on the panel background */
  color: var(--ink);
  }
  
  .help-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }
  
  .help-modal-title {
    font-size: 20px;
    font-weight: 700;
  color: var(--ink);
    margin: 0;
  }
  
  .help-modal-close {
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: rgba(255,255,255,0.7);
    transition: all 0.2s ease;
  }
  
  .help-modal-close:hover {
    background: rgba(255,255,255,0.2);
    color: var(--white);
  }
  
  .help-modal-body {
    color: var(--ink);
    line-height: 1.6;
  }

  .pir-progress-stats { display:flex; justify-content:space-between; align-items:center; gap:12px; }
  .pir-progress-stats .large { font-size:18px; font-weight:800; color:var(--ink); }
  .pir-progress-stats .muted-small { font-size:12px; color:var(--muted); }
  /* Collapse behavior for overall PIR progress section */
  .pir-progress-main.collapsed { display: none !important; }

  /* Mini progress inside each email cell */
  .email-mini-bar-bg { width:80%; height:8px; background: rgba(0,0,0,0.06); border-radius:999px; overflow:hidden; }
  .email-mini-bar-fg { height:100%; width:0%; background: linear-gradient(90deg,#dc3545,#ffc107,#10b981); transition: width .5s ease; }

  /* Email status circles (compact row design) */
  .email-status-circles {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 8px;
  padding: 18px 16px;
    background: rgba(255,255,255,0.05);
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.1);
  }

.email-status-circles.collapsed { display: none !important; }
  
  .email-circle-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
  }
  
  .email-circle-item:hover {
    transform: translateY(-2px);
  }
  
  .email-circle {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 16px;
    color: white;
    position: relative;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  }
  
  .email-circle::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    border-radius: 50%;
    transition: left 0.6s ease;
  }
  
  .email-circle-item:hover .email-circle::before {
    left: 100%;
  }
  
  .email-circle.ready {
    background: linear-gradient(135deg, #28a745, #20c997);
    box-shadow: 0 2px 12px rgba(40,167,69,0.4);
  }
  
  .email-circle.partial {
    background: linear-gradient(135deg, #ffc107, #fd7e14);
    box-shadow: 0 2px 12px rgba(255,193,7,0.4);
  }
  
  .email-circle.missing {
    background: linear-gradient(135deg, #6c757d, #495057);
    box-shadow: 0 2px 8px rgba(108,117,125,0.3);
  }
  
  .email-circle-count {
  font-size: 12px;
    font-weight: 600;
    color: var(--text-color);
    opacity: 0.8;
    transition: opacity 0.3s ease;
  }
  
  .email-circle-item:hover .email-circle-count {
    opacity: 1;
  }
  
  .email-circle-item.ready .email-circle-count {
    color: #28a745;
  }
  
  .email-circle-item.partial .email-circle-count {
    color: #fd7e14;
  }
  
  .email-circle-item.missing .email-circle-count {
    color: #6c757d;
  }

  /* Popover for email package summaries */
  .email-popover {
    position: absolute;
    min-width: 260px;
    max-width: 360px;
    background: var(--panel-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 12px;
    box-shadow: 0 12px 30px rgba(2,6,23,0.25);
    color: var(--ink);
    z-index: 1400;
    transform-origin: top right;
    animation: popIn .18s cubic-bezier(.2,.9,.2,1);
  }

  .email-popover .pop-list {
    max-height: 220px;
    overflow: auto;
    margin-top: 8px;
    padding-right: 6px;
  }

  @keyframes popIn {
    from { transform: scale(.92) translateY(-6px); opacity: 0; }
    to { transform: scale(1) translateY(0); opacity: 1; }
  }

  .email-popover h4 { margin: 0 0 8px; font-size: 14px; }
  .email-popover .pop-row { display:flex; justify-content:space-between; gap:8px; padding:6px 0; border-bottom:1px dashed rgba(0,0,0,0.04); }
  .email-popover .pop-row:last-child { border-bottom: none; }
  .email-popover .pop-actions { display:flex; gap:8px; margin-top:10px; justify-content:flex-end; }
  .email-popover .pill { padding:6px 10px; border-radius:12px; font-size:12px; }
  .email-popover .pill.ready { background: linear-gradient(90deg,#34d399,#10b981); color:white; }
  .email-popover .pill.partial { background: linear-gradient(90deg,#ffd580,#ffb020); color:#3b2f00; }
  .email-popover .pill.missing { background: #f1f5f9; color:var(--muted); border:1px solid var(--border-color); }

  .email-cell {
    padding: 10px;
    border-radius: 10px;
    text-align: center;
    font-weight: 700;
    font-size: 13px;
    border: 1px solid var(--border-color);
    background: var(--panel-bg);
    color: var(--muted);
    display:flex;
    flex-direction:column;
    gap:4px;
    align-items:center;
    justify-content:center;
  }

  .email-cell.ready {
    background: linear-gradient(180deg, #34d399, #10b981);
    color: white;
    border-color: rgba(16,185,129,0.25);
  }

  .email-cell.partial {
    background: linear-gradient(180deg, #ffd580, #ffb020);
    color: #3b2f00;
    border-color: rgba(255,176,32,0.16);
  }

  .email-cell.missing {
    background: var(--glass-2);
    color: var(--muted);
    border-style: dashed;
  }

  .email-cell .email-num { font-size: 12px; opacity: .9; }
  .email-cell .email-count { font-size: 14px; }
  
  /* Filter pills */
  .pir-filters {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  
  .pir-filter-pill {
    padding: 8px 16px;
    border-radius: 20px;
    background: var(--glass);
    border: 1px solid var(--border-color);
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 13px;
    font-weight: 500;
    white-space: nowrap;
  }
  
  .pir-filter-pill:hover {
    background: var(--glass-2);
    transform: translateY(-1px);
  }
  
  .pir-filter-pill.active {
    background: var(--accent);
    color: var(--white);
    border-color: var(--accent);
  }
  
  /* Sidebar TOC for categories */
  .pir-layout {
    display: grid;
    grid-template-columns: 200px 1fr;
    gap: 24px;
    height: 100%;
    overflow: hidden;
  }
  
  .pir-toc {
    background: var(--glass);
    border-radius: 16px;
    border: 1px solid var(--border-color);
    padding: 16px;
    overflow-y: auto;
    max-height: calc(100vh - 280px);
  }
  
  .pir-toc-title {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 12px;
    color: var(--white);
  }
  
  .pir-toc-item {
    display: block;
    padding: 8px 12px;
    margin: 2px 0;
    border-radius: 8px;
    color: var(--muted);
    text-decoration: none;
    font-size: 12px;
    transition: all 0.2s ease;
    cursor: pointer;
    line-height: 1.3;
  }
  
  .pir-toc-item:hover {
    background: var(--glass-2);
    color: var(--white);
  }
  
  .pir-toc-item.active {
    background: var(--accent);
    color: var(--white);
  }
  
  .pir-main {
    overflow-y: auto;
    max-height: calc(100vh - 280px);
  }
  
  /* Category sections with sticky headers */
  .doc-category {
    margin-bottom: 32px;
    scroll-margin-top: 70px;
  }
  
  .doc-category-title {
    position: sticky;
    top: 0;
    z-index: 10;
    font-size: 16px;
    font-weight: 700;
    color: var(--accent-2);
    background: var(--panel-bg);
    backdrop-filter: blur(8px);
    border-bottom: 2px solid var(--accent-2);
    padding: 12px 0 8px 0;
    margin-bottom: 16px;
  }
  
  /* Enhanced table rows with hover actions */
  .pir-table-row {
    border: 1px solid var(--border-color);
    border-radius: 12px;
    margin-bottom: 12px;
    transition: all 0.2s ease;
    background: var(--glass);
    overflow: hidden;
    padding: 16px 20px;
    display: grid;
    /* Fixed columns for consistent alignment across rows */
    grid-template-columns: 40px minmax(250px, 1fr) 140px 120px 190px;
    gap: 16px;
    align-items: center;
  }
  
  .pir-table-row:hover {
    border-color: var(--accent-2);
    box-shadow: 0 4px 12px rgba(118, 167, 255, 0.15);
    transform: translateY(-1px);
  }
  
  .pir-row-title {
    font-weight: 600;
    color: var(--white);
    font-size: 14px;
  }
  
  .pir-row-type {
    font-size: 12px;
    color: var(--muted);
    margin-top: 4px;
  }
  
  /* Action column specific styling */
  .pir-table-row > div:last-child {
    width: 100%;
    padding-right: 0;
  }
  
  .pir-row-actions {
    display: flex;
    gap: 4px;
    opacity: 1; /* always visible */
    transition: opacity 0.2s ease;
    white-space: nowrap; /* prevent button wrapping */
    justify-content: flex-start; /* left align buttons */
    width: 100%; /* take up full column width */
  }
  
  .pir-action-btn {
    padding: 6px 10px;
    min-width: 55px;
    text-align: center;
    font-size: 12px;
    border-radius: 6px;
    background: var(--glass-2);
    border: 1px solid var(--border-color);
    color: var(--white);
    cursor: pointer;
    margin-right: 0;
    justify-self: flex-start;
    flex-shrink: 0;
    transition: all 0.2s ease;
  }
  
  .pir-action-btn:hover {
    background: var(--accent-2);
    border-color: var(--accent);
  }
  
  .pir-action-btn.primary {
    background: var(--accent);
    border-color: var(--accent);
  }
  
  /* Status chips with enhanced styling */
  .pir-status-chip {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .pir-status-chip.not-attached {
    background: var(--glass-2);
    color: var(--muted);
  }
  
  .pir-status-chip.uploaded {
    background: var(--stat-3-bg);
    color: var(--stat-3-color);
  }
  
  .pir-status-chip.ready {
    background: var(--stat-2-bg);
    color: var(--stat-2-color);
  }
  
  .pir-status-chip.outdated {
    background: #ff8c0033;
    color: #ff8c00;
  }
  
  .pir-status-chip.draft {
    background: #8b5cf633;
    color: #8b5cf6;
  }
  
  .pir-status-chip.expired {
    background: #dc354533;
    color: #dc3545;
    font-weight: 600;
    animation: pulse-warning 2s infinite;
  }
  
  .pir-status-chip.expiring-soon {
    background: #ffc10733;
    color: #ffc107;
    font-weight: 600;
  }

  @keyframes pulse-warning {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }

  /* Certificate tracking styles */
  .certificate-tracking {
    border-left: 4px solid var(--accent-2);
  }
  
  .certificate-tracking h4 {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
  }
  
  .enhanced-pir-modal .info-value.status-expired {
    color: #dc3545;
    font-weight: 600;
  }
  
  .enhanced-pir-modal .info-value.status-expiring-soon {
    color: #ffc107;
    font-weight: 600;
  }

  /* Enhanced PIR Modal Styles */
  .enhanced-pir-modal {
    backdrop-filter: blur(8px);
  }
  
  .enhanced-pir-content {
    width: min(95vw, 1200px);
    height: min(90vh, 800px);
    max-width: none;
    max-height: none;
    display: flex;
    flex-direction: column;
    background: var(--panel-bg);
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  }
  
  .enhanced-pir-header {
    padding: 24px;
    border-bottom: 1px solid var(--border-color);
    background: linear-gradient(135deg, var(--panel-bg) 0%, var(--glass) 100%);
    border-radius: 16px 16px 0 0;
  }
  
  .enhanced-pir-header .header-main {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
  }
  
  .enhanced-pir-header h2 {
    margin: 0;
    font-size: 24px;
    color: var(--white);
    max-width: 70%;
  }
  
  .enhanced-pir-header .header-meta {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }
  
  .category-badge, .item-type-badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
  }
  
  .category-badge {
    background: var(--accent-2)33;
    color: var(--accent-2);
  }
  
  .item-type-badge {
    background: var(--muted)33;
    color: var(--muted);
  }
  
  .enhanced-pir-body {
    display: flex;
    flex: 1;
    overflow: hidden;
  }
  
  .enhanced-pir-sidebar {
    width: 300px;
    padding: 24px;
    border-right: 1px solid var(--border-color);
    overflow-y: auto;
    background: var(--glass);
  }
  
  .enhanced-info-section {
    margin-bottom: 32px;
  }
  
  .enhanced-info-section h4 {
    margin: 0 0 16px 0;
    font-size: 16px;
    color: var(--accent-2);
    font-weight: 600;
  }
  
  .enhanced-info-item {
    display: flex;
    flex-direction: column;
    margin-bottom: 16px;
  }
  
  .info-label {
    font-size: 12px;
    color: var(--muted);
    margin-bottom: 4px;
    font-weight: 500;
  }
  
  .info-value {
    font-size: 14px;
    color: var(--white);
    word-wrap: break-word;
  }
  
  .enhanced-actions-section h4 {
    margin: 0 0 16px 0;
    font-size: 16px;
    color: var(--accent-2);
    font-weight: 600;
  }
  
  .enhanced-action-buttons {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  .enhanced-action-buttons .btn {
    justify-content: flex-start;
    gap: 8px;
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 14px;
  }
  
  .enhanced-pir-preview {
    flex: 1;
    padding: 24px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  
  .enhanced-preview-loading, 
  .enhanced-preview-error, 
  .enhanced-preview-empty,
  .enhanced-preview-unsupported {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    gap: 16px;
  }
  
  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--glass);
    border-top: 3px solid var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .form-grid {
    display: grid;
    gap: 16px;
  }
  
  .form-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    margin-top: 24px;
    padding-top: 16px;
    border-top: 1px solid var(--border-color);
  }
  
  
  .error-icon, .empty-icon, .file-icon {
    font-size: 48px;
    opacity: 0.7;
  }
  
  .enhanced-preview-error h4,
  .enhanced-preview-empty h4,
  .enhanced-preview-unsupported h4 {
    margin: 0;
    color: var(--white);
    font-size: 18px;
  }
  
  .enhanced-preview-error p,
  .enhanced-preview-empty p,
  .enhanced-preview-unsupported p {
    margin: 0;
    color: var(--muted);
    font-size: 14px;
    line-height: 1.5;
  }
  
  .enhanced-pdf-preview,
  .enhanced-image-preview {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .enhanced-pir-footer {
    padding: 20px 24px;
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: flex-end;
    background: var(--glass);
    border-radius: 0 0 16px 16px;
  }
  
  /* Mobile responsiveness */
  @media (max-width: 768px) {
    .enhanced-pir-content {
      width: 100vw;
      height: 100vh;
      border-radius: 0;
    }
    
    .enhanced-pir-body {
      flex-direction: column;
    }
    
    .enhanced-pir-sidebar {
      width: auto;
      border-right: none;
      border-bottom: 1px solid var(--border-color);
      max-height: 200px;
    }
  }
  
  /* Bulk operations bar */
  .pir-bulk-bar {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--panel-bg);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 12px 20px;
    display: flex;
    gap: 12px;
    align-items: center;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(12px);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    z-index: 20;
  }
  
  .pir-bulk-bar.visible {
    opacity: 1;
    visibility: visible;
  }
  
  .pir-bulk-count {
    font-weight: 600;
    color: var(--white);
  }
  
  /* Mobile responsive card layout */
  @media (max-width: 768px) {
    .pir-layout {
      grid-template-columns: 1fr;
      gap: 16px;
    }
    
    .pir-toc {
      display: none;
    }
    
    .pir-table-row {
      grid-template-columns: 1fr;
      gap: 12px;
      padding: 16px;
    }
    
    .pir-row-actions {
      opacity: 1;
      margin-top: 8px;
      flex-wrap: wrap;
      justify-content: flex-start;
      width: 100%;
    }
  }
  
  /* Draft text support */
  .pir-draft-indicator {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    color: var(--accent-2);
    margin-top: 4px;
  }
  
  .pir-draft-badge {
    background: var(--accent);
    color: var(--white);
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 600;
  }
  
  /* Notes indicator */
  .pir-notes-indicator {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    color: var(--success);
    margin-top: 4px;
  }
  
  .pir-notes-badge {
    font-size: 12px;
  }
  
  .pir-action-btn.has-notes {
    background: var(--success-bg);
    border-color: var(--success);
    color: var(--success);
    font-weight: 600;
  }
  
  /* PIR Notes Modal */
  .pir-notes-modal .modal-content {
    max-width: 600px;
    width: 90%;
  }
  
  .pir-notes-modal textarea {
    min-height: 200px;
    resize: vertical;
    font-family: inherit;
  }
  
  .pir-notes-modal .btn.success {
    background-color: var(--success);
    border-color: var(--success);
    color: var(--white);
  }
  
  .pir-notes-modal .btn.error {
    background-color: var(--error);
    border-color: var(--error);
    color: var(--white);
  }
  
  /* Column sorting */
  .pir-sort-header {
    cursor: pointer;
    user-select: none;
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 0;
    font-weight: 600;
  }
  
  .pir-sort-header:hover {
    color: var(--accent-2);
  }
  
  .pir-sort-arrow {
    font-size: 10px;
    opacity: 0.6;
    transition: all 0.2s ease;
  }
  
  .pir-sort-header.active .pir-sort-arrow {
    opacity: 1;
    color: var(--accent);
  }
  
  /* Enhanced PIR Modal Styles */
  .enhanced-pir-modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.75);
    display: none;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(8px);
    animation: modalFadeIn 0.3s ease-out;
  }
  
  .enhanced-pir-modal.show {
    display: flex;
  }
  
  .enhanced-pir-content {
    background: var(--panel-bg);
    border-radius: 16px;
    width: 95vw;
    height: 90vh;
    max-width: 1400px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    border: 1px solid var(--border-color);
    animation: modalSlideIn 0.3s ease-out;
  }
  
  .enhanced-pir-header {
    padding: 24px 32px;
    border-bottom: 1px solid var(--border-color);
    background: linear-gradient(135deg, var(--glass) 0%, var(--panel-bg) 100%);
  }
  
  .enhanced-pir-header .header-main {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 12px;
  }
  
  .enhanced-pir-header h2 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--white);
    flex: 1;
  }
  
  .enhanced-pir-header .header-meta {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  
  .category-badge {
    background: var(--accent);
    color: var(--panel-bg);
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
  }
  
  .item-type-badge {
    background: var(--glass);
    color: var(--white);
    border: 1px solid var(--border-color);
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
  }
  
  .enhanced-pir-body {
    display: flex;
    flex: 1;
    overflow: hidden;
  }
  
  .enhanced-pir-sidebar {
    width: 300px;
    background: var(--glass);
    border-right: 1px solid var(--border-color);
    padding: 24px;
    overflow-y: auto;
    flex-shrink: 0;
  }
  
  .enhanced-info-section,
  .enhanced-actions-section,
  .enhanced-notes-section {
    margin-bottom: 32px;
  }
  
  .enhanced-info-section h4,
  .enhanced-actions-section h4,
  .enhanced-notes-section h4 {
    margin: 0 0 16px 0;
    font-size: 1rem;
    font-weight: 600;
    color: var(--white);
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border-color);
  }
  
  .enhanced-notes-display {
    background: var(--glass);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 12px;
  }
  
  .enhanced-notes-display .notes-content {
    color: var(--white);
    font-size: 0.875rem;
    line-height: 1.5;
    margin-bottom: 16px;
    white-space: pre-wrap;
  }
  
  .enhanced-notes-empty {
    padding: 16px;
    text-align: center;
    border: 2px dashed var(--border-color);
    border-radius: 8px;
    background: var(--glass);
  }
  
  .enhanced-notes-empty p {
    margin: 0 0 12px 0;
    font-style: italic;
  }
  
  .btn.small {
    padding: 6px 12px;
    font-size: 0.75rem;
  }
  
  .enhanced-info-item {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-bottom: 16px;
  }
  
  .info-label {
    font-size: 0.75rem;
    color: var(--muted);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .info-value {
    font-size: 0.875rem;
    color: var(--white);
    word-break: break-word;
  }
  
  .info-value.status-ready { color: var(--success); }
  .info-value.status-warning { color: var(--warning); }
  .info-value.status-danger { color: var(--danger); }
  
  .enhanced-action-buttons {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  .enhanced-action-buttons .btn {
    justify-content: flex-start;
    gap: 8px;
  }
  
  .enhanced-pir-preview {
    flex: 1;
    padding: 24px;
    overflow-y: auto;
    background: var(--panel-bg);
  }
  
  .enhanced-pdf-preview {
    height: 100%;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
  }
  
  .enhanced-image-preview {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    background: var(--glass);
    border-radius: 8px;
    padding: 20px;
  }
  
  .enhanced-preview-loading,
  .enhanced-preview-error,
  .enhanced-preview-empty,
  .enhanced-preview-unsupported {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    text-align: center;
    padding: 40px;
    color: var(--muted);
  }
  
  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--border-color);
    border-top: 3px solid var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 16px;
  }
  
  .error-icon,
  .empty-icon,
  .file-icon {
    font-size: 3rem;
    margin-bottom: 16px;
  }
  
  .enhanced-preview-error h4,
  .enhanced-preview-empty h4,
  .enhanced-preview-unsupported h4 {
    color: var(--white);
    margin: 0 0 12px 0;
    font-size: 1.25rem;
    font-weight: 600;
  }
  
  .enhanced-preview-error p,
  .enhanced-preview-empty p,
  .enhanced-preview-unsupported p {
    margin: 0 0 8px 0;
    line-height: 1.5;
  }
  
  .enhanced-pir-footer {
    padding: 20px 32px;
    border-top: 1px solid var(--border-color);
    background: var(--glass);
    display: flex;
    justify-content: flex-end;
  }
  
  @keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes modalSlideIn {
    from { 
      opacity: 0;
      transform: translateY(20px) scale(0.95);
    }
    to { 
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  /* Responsive design for smaller screens */
  @media (max-width: 1024px) {
    .enhanced-pir-content {
      width: 98vw;
      height: 95vh;
    }
    
    .enhanced-pir-body {
      flex-direction: column;
    }
    
    .enhanced-pir-sidebar {
      width: 100%;
      max-height: 200px;
      border-right: none;
      border-bottom: 1px solid var(--border-color);
    }
    
    .enhanced-info-section,
    .enhanced-actions-section {
      margin-bottom: 16px;
    }
    
    .enhanced-info-item {
      margin-bottom: 8px;
    }
  }

  /* Holiday Management Styles */
  #holidays .panel {
    overflow: visible;
  }
  
  #holidays .table-wrap {
    overflow-x: auto;
    padding: 0;
    border-radius: 12px;
  }
  
  #holidays table {
    min-width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }
  
  #holidays th, #holidays td {
    white-space: nowrap;
    padding: 12px 16px;
  }
  
  #holidays th {
    position: sticky;
    top: 0;
    z-index: 10;
    background: var(--panel-bg);
  }
  
  #entitlements-list table, #requests-list table {
    width: 100%;
  }
  
  /* Responsive styling for small screens */
  @media (max-width: 768px) {
    #holidays .table-wrap {
      max-width: 100%;
      overflow-x: auto;
    }
    
    #holidays table {
      min-width: 800px;
    }
  }
  
  /* PDF preview modal enhancements */
  .pir-preview-modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.85);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 50;
    backdrop-filter: blur(4px);
  }
  
  .pir-preview-modal.show {
    display: flex;
  }
  
  .pir-preview-content {
    background: var(--panel-bg);
    border-radius: 16px;
    width: 90vw;
    height: 90vh;
    max-width: 1200px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  
  .pir-preview-header {
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .pir-preview-body {
    flex: 1;
    overflow: auto;
    padding: 0;
  }
  
  .pir-preview-close {
    background: var(--glass);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 8px 12px;
    color: var(--white);
    cursor: pointer;
  }
  
  #pir-tbody tr { cursor: pointer; }

  /* Pre‑Inspection panel should fill viewport and allow inner scrolling */
  #view-pre-inspection .panel {
    min-height: calc(100vh - 190px);
    display: flex;
    flex-direction: column;
  }
  /* Make the documents container the scrollable area */
  #view-pre-inspection #pir-docs-container {
    flex: 1 1 auto;
    overflow-y: auto;
    max-height: none;            /* override .table-wrap default 420px cap */
    -webkit-overflow-scrolling: touch; /* iOS/Safari momentum scroll */
    overscroll-behavior: contain;      /* prevent scroll chaining */
  }

  /* Dynamic & Multi-Input Form Styles */
  .multi-input-container { display: flex; gap: 12px; align-items: flex-start; }
  .multi-input-container .field { flex: 1; margin-top: 0; }
  .dynamic-table-row { display: flex; gap: 8px; align-items: center; }
  .dynamic-table-row input { flex: 1; }

  
  /* Bulk Upload Additional Styles */
  .tab-panel {
    animation: fadeIn 0.3s ease;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .upload-area {
    background: var(--glass);
    position: relative;
    overflow: hidden;
  }
  
  .upload-area:hover {
    transform: scale(1.02);
    box-shadow: 0 4px 20px rgba(118, 167, 255, 0.2);
  }
  
  .upload-area.dragging {
    background: var(--glass-2);
    border-color: var(--accent) !important;
  }
  
  .upload-section {
    animation: slideIn 0.4s ease;
  }
  
  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-20px); }
    to { opacity: 1; transform: translateX(0); }
  }
  
  
  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .tab-button {
    background: transparent;
    border: none;
    padding: 12px 16px;
    color: var(--muted);
    cursor: pointer;
    border-radius: 8px 8px 0 0;
    transition: all 0.2s ease;
    font-size: 14px;
    font-weight: 500;
    position: relative;
  }

  .tab-button:hover {
    background: var(--glass);
    color: var(--white);
  }

  .tab-button.active {
    background: var(--accent);
    color: var(--white);
    box-shadow: 0 2px 8px rgba(118, 167, 255, 0.3);
  }

  .tab-content {
    min-height: 400px;
  }

  .table-view {
    display: none;
  }

  .table-view.active {
    display: block;
  }

  .table-container {
    background: var(--glass);
    border-radius: var(--round);
    padding: 20px;
    overflow-x: auto;
  }


  .loading-indicator {
    text-align: center;
    color: var(--muted);
    padding: 40px;
    font-style: italic;
  }

  .error-message {
    color: var(--danger);
    background: rgba(255, 107, 107, 0.1);
    border: 1px solid var(--danger);
    border-radius: 8px;
    padding: 16px;
    margin: 20px 0;
    text-align: center;
  }

  .empty-state {
    text-align: center;
    color: var(--muted);
    padding: 40px;
    font-style: italic;
  }

  .null-value {
    color: var(--muted);
    font-style: italic;
  }

  .boolean-value {
    color: var(--accent);
    font-weight: 600;
  }

  .object-value {
    color: var(--warning);
    font-family: monospace;
    font-size: 12px;
  }

  /* Invitation Modal Styles */
  .invitation-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10000;
    animation: fadeIn 0.3s ease;
  }

  .invitation-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .invitation-modal-content {
    background: var(--panel-bg);
    border: 1px solid var(--border-color);
    border-radius: var(--round);
    padding: 32px;
    width: 90%;
    max-width: 500px;
    box-shadow: var(--shadow);
    animation: slideDown 0.3s ease;
  }

  .invitation-modal-header {
    margin-bottom: 24px;
  }

  .invitation-modal-title {
    font-size: 24px;
    font-weight: 700;
    color: var(--white);
    margin-bottom: 8px;
  }

  .invitation-modal-subtitle {
    color: var(--muted);
    font-size: 14px;
  }

  .invitation-form-group {
    margin-bottom: 20px;
  }

  .invitation-form-label {
    display: block;
    color: var(--white);
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 8px;
  }

  .invitation-form-input,
  .invitation-form-select {
    width: 100%;
    padding: 12px 16px;
    background: var(--glass);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    color: var(--white);
    font-size: 14px;
    transition: all 0.2s ease;
  }

  .invitation-form-input:focus,
  .invitation-form-select:focus {
    outline: none;
    border-color: var(--accent);
    background: var(--glass-2);
  }

  .invitation-form-select option {
    background: #0c275e;
    color: var(--white);
  }

  .invitation-form-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
  }

  .invitation-btn {
    flex: 1;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .invitation-btn-primary {
    background: var(--accent);
    color: var(--white);
  }

  .invitation-btn-primary:hover {
    background: var(--accent-2);
    transform: translateY(-1px);
  }

  .invitation-btn-primary:disabled {
    background: var(--glass);
    color: var(--muted);
    cursor: not-allowed;
    transform: none;
  }

  .invitation-btn-secondary {
    background: var(--glass);
    color: var(--muted);
    border: 1px solid var(--border-color);
  }

  .invitation-btn-secondary:hover {
    background: var(--glass-2);
    color: var(--white);
  }

  .invitation-success-message,
  .invitation-error-message {
    padding: 12px 16px;
    border-radius: 8px;
    margin-top: 16px;
    font-size: 14px;
    display: none;
  }

  .invitation-success-message {
    background: rgba(43, 212, 167, 0.2);
    border: 1px solid var(--success);
    color: var(--success);
  }

  .invitation-error-message {
    background: rgba(255, 107, 107, 0.2);
    border: 1px solid var(--danger);
    color: var(--danger);
  }

  .invitation-success-message.active,
  .invitation-error-message.active {
    display: block;
  }

  /* Invite Button in Header */
  .invite-user-btn {
    background: var(--success);
    color: var(--white);
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }

  .invite-user-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(43, 212, 167, 0.4);
  }

  .invite-user-btn svg {
    width: 16px;
    height: 16px;
  }

  /* Header Styles */
  .header {
    background: var(--panel-bg);
    border-bottom: 1px solid var(--border-color);
    padding: 20px 0;
    margin-bottom: 32px;
  }

  .header-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .header-title {
    font-size: 28px;
    font-weight: 800;
    margin: 0;
    background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .header-actions {
    display: flex;
    gap: 12px;
  }

  /* Main Content Styles */
  .main-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 24px 40px;
  }

  .container {
    width: 100%;
  }

  .panel {
    background: var(--panel-bg);
    border: 1px solid var(--border-color);
    border-radius: var(--round);
    overflow: hidden;
  }

  .panel-header {
    padding: 20px 24px;
    border-bottom: 1px solid var(--border-color);
  }

  .panel-title {
    font-size: 20px;
    font-weight: 700;
    color: var(--white);
    margin: 0;
  }

  .panel-content {
    padding: 24px;
  }

  /* Table Styles */
  .table-container {
    overflow-x: auto;
  }

  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }

  thead {
    background: var(--glass);
  }

  th {
    padding: 12px 16px;
    text-align: left;
    font-size: 13px;
    font-weight: 600;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 1px solid var(--border-color);
  }

  td {
    padding: 16px;
    font-size: 14px;
    color: var(--white);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  }

  tbody tr:hover {
    background: var(--glass);
  }

  /* Badge Styles */
  .badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .badge-primary {
    background: var(--accent);
    color: var(--white);
  }

  .badge-secondary {
    background: var(--glass-2);
    color: var(--muted);
  }

  .badge-success {
    background: var(--success);
    color: var(--white);
  }

  .badge-warning {
    background: var(--warning);
    color: #3b2f00;
  }

  /* Button Styles */
  .btn {
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .btn-secondary {
    background: var(--glass);
    color: var(--muted);
    border: 1px solid var(--border-color);
  }

  .btn-secondary:hover {
    background: var(--glass-2);
    color: var(--white);
  }

  /* Loading and Empty States */
  .loading-indicator {
    text-align: center;
    color: var(--muted);
    padding: 40px;
    font-style: italic;
  }

  .empty-state {
    text-align: center;
    color: var(--muted);
    padding: 40px;
    font-style: italic;
  }

  .error-message {
    color: var(--danger);
    background: rgba(255, 107, 107, 0.1);
    border: 1px solid var(--danger);
    border-radius: 8px;
    padding: 16px;
    margin: 20px 0;
    text-align: center;
  }
</style>
</head>
<body>
<div class="bg"></div>

<div id="app">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <h1 class="header-title">Admin Dashboard</h1>
      <div class="header-actions">
        <button class="invite-user-btn" onclick="showInvitationModal()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
          </svg>
          Invite User
        </button>
        <button class="btn btn-secondary" onclick="handleLogout()">Logout</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="container">
      <!-- Users Table Section -->
      <div class="panel">
        <div class="panel-header">
          <h2 class="panel-title">Users</h2>
        </div>
        <div class="panel-content">
          <div id="usersTableContainer" class="table-container">
            <div class="loading-indicator">Loading users...</div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Invitation Modal -->
<div id="invitationModal" class="invitation-modal">
  <div class="invitation-modal-content">
    <div class="invitation-modal-header">
      <h2 class="invitation-modal-title">Invite New User</h2>
      <p class="invitation-modal-subtitle">Send an invitation to join the system</p>
    </div>

    <form id="invitationForm" onsubmit="handleInvitationSubmit(event)">
      <div class="invitation-form-group">
        <label class="invitation-form-label" for="inviteName">Name</label>
        <input
          type="text"
          id="inviteName"
          class="invitation-form-input"
          placeholder="Enter user's full name"
          required
        />
      </div>

      <div class="invitation-form-group">
        <label class="invitation-form-label" for="inviteEmail">Email</label>
        <input
          type="email"
          id="inviteEmail"
          class="invitation-form-input"
          placeholder="Enter user's email address"
          required
        />
      </div>

      <div class="invitation-form-group">
        <label class="invitation-form-label" for="inviteAccessType">Access Type</label>
        <select id="inviteAccessType" class="invitation-form-select" required>
          <option value="">Select access type</option>
          <option value="staff">Staff</option>
          <option value="admin">Admin</option>
        </select>
      </div>

      <div id="invitationSuccessMessage" class="invitation-success-message"></div>
      <div id="invitationErrorMessage" class="invitation-error-message"></div>

      <div class="invitation-form-actions">
        <button type="submit" id="inviteSubmitBtn" class="invitation-btn invitation-btn-primary">
          Send Invitation
        </button>
        <button type="button" class="invitation-btn invitation-btn-secondary" onclick="hideInvitationModal()">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>

<script type="module">
  // Initialize dashboard
  async function bootstrap() {
    console.log('Dashboard bootstrap started');
    await loadUsers();
  }

  // Load users table
  async function loadUsers() {
    const container = document.getElementById('usersTableContainer');

    try {
      const { data, error } = await window.supabase
        .from('master_users')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) throw error;

      if (!data || data.length === 0) {
        container.innerHTML = '<div class="empty-state">No users found</div>';
        return;
      }

      // Build table HTML
      let tableHTML = `
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Access Type</th>
              <th>Status</th>
              <th>Created</th>
            </tr>
          </thead>
          <tbody>
      `;

      data.forEach(user => {
        const createdDate = new Date(user.created_at).toLocaleDateString();
        const status = user.invitation_token ? 'Invited' : 'Active';
        const statusClass = user.invitation_token ? 'warning' : 'success';

        tableHTML += `
          <tr>
            <td>${user.full_name || '-'}</td>
            <td>${user.email || '-'}</td>
            <td><span class="badge badge-${user.access_type === 'admin' ? 'primary' : 'secondary'}">${user.access_type || '-'}</span></td>
            <td><span class="badge badge-${statusClass}">${status}</span></td>
            <td>${createdDate}</td>
          </tr>
        `;
      });

      tableHTML += '</tbody></table>';
      container.innerHTML = tableHTML;

    } catch (error) {
      console.error('Error loading users:', error);
      container.innerHTML = `<div class="error-message">Error loading users: ${error.message}</div>`;
    }
  }

  // Show invitation modal
  window.showInvitationModal = function() {
    document.getElementById('invitationModal').classList.add('active');
    document.getElementById('invitationForm').reset();
    document.getElementById('invitationSuccessMessage').classList.remove('active');
    document.getElementById('invitationErrorMessage').classList.remove('active');
  }

  // Hide invitation modal
  window.hideInvitationModal = function() {
    document.getElementById('invitationModal').classList.remove('active');
  }

  // Handle invitation form submission
  window.handleInvitationSubmit = async function(event) {
    event.preventDefault();

    const submitBtn = document.getElementById('inviteSubmitBtn');
    const successMsg = document.getElementById('invitationSuccessMessage');
    const errorMsg = document.getElementById('invitationErrorMessage');

    // Reset messages
    successMsg.classList.remove('active');
    errorMsg.classList.remove('active');

    // Disable submit button
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';

    try {
      const name = document.getElementById('inviteName').value;
      const email = document.getElementById('inviteEmail').value;
      const accessType = document.getElementById('inviteAccessType').value;

      // Use the secure invitation handler
      const result = await window.sendInvitation(name, email, accessType);

      if (!result.success) {
        throw new Error(result.error || 'Failed to send invitation');
      }

      // Show success message with invitation link for testing
      successMsg.innerHTML = `
        Invitation created successfully!<br>
        <small style="opacity: 0.8">Send this link to ${email}:</small><br>
        <code style="font-size: 11px; word-break: break-all;">${result.invitationLink}</code>
      `;
      successMsg.classList.add('active');

      // Reload users table
      await loadUsers();

      // Reset form and close modal after 5 seconds (longer to allow copying the link)
      setTimeout(() => {
        hideInvitationModal();
      }, 5000);

    } catch (error) {
      console.error('Error sending invitation:', error);
      errorMsg.textContent = `Error: ${error.message}`;
      errorMsg.classList.add('active');
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Send Invitation';
    }
  }

  // Handle logout
  window.handleLogout = async function() {
    await window.supabase.auth.signOut();
    window.location.href = 'admin-login.html';
  }

  // Close modal on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      hideInvitationModal();
    }
  });

  // Close modal on background click
  document.getElementById('invitationModal').addEventListener('click', (e) => {
    if (e.target === e.currentTarget) {
      hideInvitationModal();
    }
  });

  // Make bootstrap available globally
  window.bootstrap = bootstrap;
</script>

</body>
</html>

