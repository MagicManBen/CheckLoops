<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teams Table Test</title>
    <script src="config.js"></script>
</head>
<body>
    <h1>Teams Table Structure Test</h1>
    <div id="results"></div>

    <script type="module">
        import { initSupabase } from './staff-common.js';

        (async function() {
            try {
                const supabase = await initSupabase();
                const resultsDiv = document.getElementById('results');
                
                // Test 1: Check if teams table exists and get structure
                console.log('Testing teams table structure...');
                
                // First get user's site_id for testing
                const { data: { session } } = await supabase.auth.getSession();
                if (!session) {
                    resultsDiv.innerHTML = '<p style="color: red;">Not authenticated. Please login first.</p>';
                    return;
                }
                
                // Try to get user's site_id
                const { data: userData } = await supabase
                    .from('master_users')
                    .select('site_id')
                    .eq('auth_user_id', session.user.id)
                    .single();
                
                const siteId = userData?.site_id;
                console.log('User site_id:', siteId);
                
                // Test the teams table query (same as in staff-calendar.html)
                const { data: teams, error } = await supabase
                    .from('teams')
                    .select('id, name, site_id')
                    .eq('site_id', siteId)
                    .order('name', { ascending: true });
                
                let html = '<h2>Test Results</h2>';
                
                if (error) {
                    html += `<p style="color: red;"><strong>Error:</strong> ${error.message}</p>`;
                } else {
                    html += `<p style="color: green;"><strong>Success!</strong> Teams table is accessible.</p>`;
                    html += `<p><strong>Site ID:</strong> ${siteId}</p>`;
                    html += `<p><strong>Teams found:</strong> ${teams?.length || 0}</p>`;
                    
                    if (teams && teams.length > 0) {
                        html += '<h3>Available Teams:</h3><ul>';
                        teams.forEach(team => {
                            html += `<li><strong>ID:</strong> ${team.id}, <strong>Name:</strong> "${team.name}", <strong>Site ID:</strong> ${team.site_id}</li>`;
                        });
                        html += '</ul>';
                    } else {
                        html += '<p style="color: orange;">No teams found for this site. You may need to add some teams to the teams table.</p>';
                    }
                    
                    // Show the dropdown options that would be generated
                    html += '<h3>Dropdown Options that would be generated:</h3>';
                    html += '<select style="padding: 5px; margin: 10px 0;"><option value="">All Teams</option>';
                    if (teams && teams.length > 0) {
                        teams.forEach(team => {
                            html += `<option value="${team.id}">${team.name}</option>`;
                        });
                    }
                    html += '</select>';
                }
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                document.getElementById('results').innerHTML = `<p style="color: red;"><strong>Error:</strong> ${error.message}</p>`;
                console.error('Test error:', error);
            }
        })();
    </script>
</body>
</html>