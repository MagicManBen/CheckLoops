<!DOCTYPE html>
<html>
<head>
  <title>Test Supabase Direct</title>
  <script src="config.js"></script>
</head>
<body>
  <h1>Testing Supabase Connection</h1>
  <div id="status">Testing...</div>
  
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
    
    const supabase = createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY, {
      auth: { 
        persistSession: true, 
        autoRefreshToken: true, 
        detectSessionInUrl: true,
        flowType: 'pkce',
        storage: window.localStorage,
        storageKey: `sb-${CONFIG.SUPABASE_URL.split('//')[1].split('.')[0]}-auth-token`
      }
    });
    
    const statusDiv = document.getElementById('status');
    
    try {
      console.log('Attempting to sign in...');
      const { data, error } = await supabase.auth.signInWithPassword({
        email: 'benhowardmagic@hotmail.com',
        password: 'Hello1!'
      });
      
      if (error) {
        statusDiv.innerHTML = `Error: ${error.message}`;
        console.error('Login error:', error);
      } else {
        statusDiv.innerHTML = `Success! Logged in as: ${data.user.email}<br>
        Role: ${data.user.user_metadata?.role}<br>
        Site ID: ${data.user.user_metadata?.site_id}<br>
        <button onclick="window.location.href='staff.html'">Go to Staff Page</button>`;
        console.log('Success:', data);
      }
    } catch (err) {
      statusDiv.innerHTML = `Catch Error: ${err.message}`;
      console.error('Catch error:', err);
    }
  </script>

    <!-- Debug Console - Persistent across all pages -->
    <script src="debug-console.js"></script>
</body>
</html>