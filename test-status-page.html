<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Status API</title>
</head>
<body>
    <h1>Testing Status API</h1>
    <div id="results"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const { createClient } = supabase;
        const supabaseUrl = 'https://unveoqnlqnobufhublyw.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVudmVvcW5scW5vYnVmaHVibHl3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwMTcyNzYsImV4cCI6MjA3MDU5MzI3Nn0.g93OsXDpO3V9DToU7s-Z3SwBBnB84rBv0JMv-idgSME';
        const supabaseClient = createClient(supabaseUrl, supabaseAnonKey);

        async function testAPI() {
            const resultsDiv = document.getElementById('results');

            try {
                resultsDiv.innerHTML += '<h3>Testing checkSupabase...</h3>';
                const { data, error } = await supabaseClient.functions.invoke('status-check', {
                    body: { action: 'checkSupabase', params: {} }
                });

                if (error) throw error;

                resultsDiv.innerHTML += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                resultsDiv.innerHTML += '<p style="color: green;">✅ Success! The edge function is working!</p>';

                resultsDiv.innerHTML += '<h3>Testing getStatistics...</h3>';
                const { data: data2, error: error2 } = await supabaseClient.functions.invoke('status-check', {
                    body: { action: 'getStatistics', params: {} }
                });

                if (error2) throw error2;

                resultsDiv.innerHTML += '<pre>' + JSON.stringify(data2, null, 2) + '</pre>';
                resultsDiv.innerHTML += '<p style="color: green;">✅ Statistics retrieved successfully!</p>';

            } catch (error) {
                resultsDiv.innerHTML += '<p style="color: red;">❌ Error: ' + error.message + '</p>';
                console.error(error);
            }
        }

        testAPI();
    </script>
</body>
</html>