<!DOCTYPE html>
<html>
<head>
    <title>Test Heart Click</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Heart Click Test</h1>
    <p>Open console to see debug output</p>

    <div id="test-heart" style="font-size: 30px; cursor: pointer;">❤️</div>
    <div id="result"></div>

    <script>
    const { createClient } = supabase;
    const supabaseUrl = 'https://unveoqnlqnobufhublyw.supabase.co';
    const supabaseKey = 'sb_publishable_wpy7lxfbI2HwvsznlWJVKg_Zx7HnAc4';
    const client = createClient(supabaseUrl, supabaseKey);

    document.getElementById('test-heart').addEventListener('click', async function(e) {
        console.log('Heart clicked!');
        const resultDiv = document.getElementById('result');

        try {
            // Test fetching likes from activity_likes table
            const { data: likes, error } = await client
                .from('activity_likes')
                .select('*')
                .limit(5);

            if (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            } else {
                console.log('Likes data:', likes);

                if (likes && likes.length > 0) {
                    // Fetch user details for the likes
                    const userIds = [...new Set(likes.map(l => l.user_id))];
                    const { data: users, error: userError } = await client
                        .from('master_users')
                        .select('auth_user_id, nickname, full_name')
                        .in('auth_user_id', userIds);

                    if (userError) {
                        console.error('User fetch error:', userError);
                        resultDiv.innerHTML = `<p style="color: red;">User Error: ${userError.message}</p>`;
                    } else {
                        console.log('Users:', users);
                        resultDiv.innerHTML = `
                            <h3>Found ${likes.length} likes</h3>
                            <h4>Users who liked:</h4>
                            <ul>
                                ${users.map(u => `<li>${u.nickname || u.full_name || 'Unknown'}</li>`).join('')}
                            </ul>
                        `;
                    }
                } else {
                    resultDiv.innerHTML = '<p>No likes found in database</p>';
                }
            }
        } catch (err) {
            console.error('Catch error:', err);
            resultDiv.innerHTML = `<p style="color: red;">Error: ${err.message}</p>`;
        }
    });
    </script>
</body>
</html>