<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>CheckLoops • Device Setup</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="color-scheme" content="light">
<style>
  :root{--ink:#0f172a;--muted:#475569;--bd:rgba(15,23,42,.12)}
  html,body{margin:0;height:100%;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f6f9ff;color:var(--ink)}
  .bg{position:fixed;inset:0;background:
    radial-gradient(1200px 600px at -10% 0%, #d7e9ff 0%, transparent 60%),
    radial-gradient(900px 500px at 120% 30%, #e2ddff 0%, transparent 60%),
    linear-gradient(180deg,#f6f9ff,#eef4ff)}
  .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:28px}
  .card{width:min(560px,94vw);background:radial-gradient(100% 100% at 0% 0%, rgba(255,255,255,.86) 0%, rgba(255,255,255,.72) 100%);
    border:1px solid var(--bd);border-radius:22px;backdrop-filter:blur(14px);box-shadow:0 20px 60px rgba(29,110,242,.16),0 3px 10px rgba(0,0,0,.06);overflow:hidden}
  header{padding:18px 20px;display:flex;gap:12px;align-items:center;border-bottom:1px solid var(--bd)}
  .logo{width:34px;height:34px;border-radius:8px;background:linear-gradient(180deg,#88b6ff,#5fa2ff);display:grid;place-items:center;color:#fff;font-weight:900}
  h1{font-size:17px;margin:0}
  .body{padding:20px}
  h2{font-size:22px;margin:4px 0 6px}
  p{color:#475569}
  .row{display:flex;gap:10px}
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:10px;height:46px;padding:0 14px;border:none;border-radius:14px;cursor:pointer;font-weight:700;
    background:linear-gradient(180deg,#5ea2ff,#3e86f6);color:#fff;box-shadow:0 10px 26px rgba(62,134,246,.25)}
  .btn.ghost{background:transparent;color:#1f3b7a;border:1px solid rgba(31,59,122,.2);box-shadow:none}
  .ok{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:rgba(187,247,208,.7);border:1px solid rgba(22,163,74,.25);color:#065f46;font-weight:700}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--bd);border-radius:999px;background:rgba(255,255,255,.8);font-weight:600}
  input[type=text]{width:100%;height:44px;border-radius:12px;border:1px solid var(--bd);padding:0 12px;background:rgba(255,255,255,.85);font-size:15px}
  .note{font-size:13px;color:#48608f;background:linear-gradient(180deg,rgba(255,255,255,.7),rgba(255,255,255,.6));border:1px dashed rgba(62,134,246,.32);padding:10px 12px;border-radius:12px}
  .step{display:none} .step.on{display:block}
  .log{margin-top:14px;height:140px;overflow:auto;background:rgba(255,255,255,.75);border:1px solid var(--bd);border-radius:14px;padding:12px;font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px;color:#0b1f4a;white-space:pre-wrap}
</style>
</head>
<body>
<div class="bg"></div>
<div class="wrap">
  <div class="card">
    <header><div class="logo">CL</div><h1>Device Setup</h1></header>
    <div class="body">
      <!-- Step 1 -->
      <section id="s1" class="step">
        <h2>Connect to device Wi-Fi</h2>
        <p>Open iPhone Wi-Fi settings and join the device hotspot (e.g. <strong>CL-Device-XXXX</strong>). Keep this page open.</p>
        <div class="row"><button id="onap" class="btn">I’m on the device Wi-Fi</button><button id="help" class="btn ghost">Help</button></div>
        <p class="note" style="margin-top:10px">We’ll jump to the device to choose your building Wi-Fi, then bring you back here automatically.</p>
      </section>

      <!-- Step 3 -->
      <section id="s3" class="step">
        <h2>Device is online</h2>
        <p class="ok">✓ Connected to your Wi-Fi</p>
        <div class="row" style="margin-top:10px">
          <span class="pill">Device IP</span><input id="ip" type="text" readonly>
        </div>
        <p class="note" style="margin-top:10px">Next we’ll pair your scanner on the device. This opens a local page on your network.</p>
        <div class="row"><a id="pair" class="btn">Continue — Pair Scanner</a><a id="open" class="btn ghost" target="_blank" rel="noopener">Open device</a></div>
      </section>
    </div>
  </div>
</div>
<script>
(function(){
  const qs = new URLSearchParams(location.search);
  const ip = qs.get('ip') || '';
  const ok = qs.get('ok') || '';
  const step = ip && ok ? '3' : '1';

  function show(id){ document.querySelectorAll('.step').forEach(s=>s.classList.remove('on')); document.getElementById(id).classList.add('on'); }

  document.getElementById('help').onclick = ()=> alert('On iPhone: Settings → Wi-Fi → join “CL-Device-…”. Return to Safari and tap “I’m on the device Wi-Fi”.');

  document.getElementById('onap').onclick = ()=>{
    const here = new URL(location.href);
    const ret = here.origin + here.pathname; // back to this page
    const url = 'http://192.168.4.1/provision?return=' + encodeURIComponent(ret);
    location.href = url;
  };

  if (step==='3'){
    document.getElementById('ip').value = ip;
    document.getElementById('pair').href = 'http://' + ip + '/setup?return=' + encodeURIComponent(location.origin + location.pathname + '#done');
    document.getElementById('open').href = 'http://' + ip + '/';
    show('s3');
  } else {
    show('s1');
  }
})();
</script>
</body>
</html>