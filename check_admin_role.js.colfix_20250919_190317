import { createClient } from '@supabase/supabase-js';

const supabaseUrl = 'https://unveoqnlqnobufhublyw.supabase.co';
const serviceKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVudmVvcW5scW5vYnVmaHVibHl3Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NTAxNzI3NiwiZXhwIjoyMDcwNTkzMjc2fQ.CJxV14F0T2TWkAjeR4bpYiBIOwLwyfzF9WzAWwS99Xc';

const supabase = createClient(supabaseUrl, serviceKey);

async function checkAdminRole() {
    try {
        console.log('Checking admin role for benhowardmagic@hotmail.com...\n');
        
        // Check auth.users table for basic user info
        const { data: authUsers, error: authError } = await supabase.auth.admin.listUsers();
        if (authError) {
            console.error('Error fetching auth users:', authError);
            return;
        }
        
        const adminUser = authUsers.users.find(user => user.email === 'benhowardmagic@hotmail.com');
        console.log('Auth user data:', JSON.stringify(adminUser, null, 2));
        
        if (!adminUser) {
            console.log('User not found in auth.users');
            return;
        }
        
        // Check master_users table
        const { data: profile, error: profileError } = await supabase
            .from('master_users')
            .select('*')
            .eq('id', adminUser.id)
            .single();
            
        console.log('\nProfile data:');
        if (profileError) {
            console.error('Error fetching profile:', profileError);
        } else {
            console.log(JSON.stringify(profile, null, 2));
        }
        
        // Check master_users table if it exists
        const { data: userRole, error: roleError } = await supabase
            .from('master_users')
            .select('*')
            .eq('user_id', adminUser.id);
            
        console.log('\nUser roles data:');
        if (roleError) {
            console.error('Error fetching user roles:', roleError);
        } else {
            console.log(JSON.stringify(userRole, null, 2));
        }
        
        // Check master_users table if it exists
        const { data: onboarding, error: onboardingError } = await supabase
            .from('master_users')
            .select('*')
            .eq('user_id', adminUser.id);
            
        console.log('\nOnboarding data:');
        if (onboardingError) {
            console.error('Error fetching onboarding:', onboardingError);
        } else {
            console.log(JSON.stringify(onboarding, null, 2));
        }
        
        // Check staff table if it exists
        const { data: staff, error: staffError } = await supabase
            .from('staff')
            .select('*')
            .eq('user_id', adminUser.id);
            
        console.log('\nStaff data:');
        if (staffError) {
            console.error('Error fetching staff:', staffError);
        } else {
            console.log(JSON.stringify(staff, null, 2));
        }
        
    } catch (error) {
        console.error('Unexpected error:', error);
    }
}

checkAdminRole();